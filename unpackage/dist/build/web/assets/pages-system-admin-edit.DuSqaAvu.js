import{_ as a,e,N as t,s,H as o,O as r,a1 as i,q as l,r as n,a as d,c as m,w as u,i as c,o as f,h,k as p,L as g,p as w,Z as D}from"./index-1tsbwzWw.js";import{_ as b}from"./uni-easyinput.B-y-wvYA.js";import{_}from"./uni-forms-item.C04_D_PQ.js";import{_ as V}from"./uni-data-select.ZmgLG0mc.js";import{_ as k}from"./uni-forms.Cx-ojO0j.js";const T=e.database();const y=a({data:()=>({formDataId:"",showPassword:!1,formData:{adminId:"",nickname:"",account:"",password:void 0,status:"active",registerTime:0,lastLoginTime:0},rules:{account:{rules:[{required:!0,errorMessage:"管理员账号不能为空"},{minLength:3,errorMessage:"账号长度不能小于3位"}]},nickname:{rules:[{required:!0,errorMessage:"管理员昵称不能为空"}]},password:{rules:[{minLength:6,errorMessage:"密码长度不能小于6位"}]}},statusOptions:[{value:"active",text:"正常"},{value:"inactive",text:"未激活"},{value:"banned",text:"已禁用"}]}),computed:{formattedRegisterTime(){return this.formatDateTime(this.formData.registerTime)},formattedLastLoginTime(){return this.formatDateTime(this.formData.lastLoginTime)}},onLoad(a){a.id&&this.getDetail(a.id)},methods:{trigger(){this.showPassword=!this.showPassword,this.showPassword||(this.formData.password=void 0)},formatDateTime(a){if(!a)return"";try{return new Date(a).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")}catch(e){return console.error("时间格式化错误:",e),""}},getDetail(a){t({mask:!0}),T.collection("Admin").where(`adminId == "${a}"`).get().then((a=>{const e=a.result.data[0];e?(this.formData={...this.formData,...e,password:void 0},this.formDataId=e.adminId):s({content:"未找到管理员信息",showCancel:!1,success:()=>{o()}})})).catch((a=>{s({content:a.message||"请求服务失败",showCancel:!1})})).finally((()=>{r()}))},async submitForm(){try{await this.$refs.form.validate(),t({title:"保存中...",mask:!0});const a={nickname:this.formData.nickname,account:this.formData.account,status:this.formData.status};this.showPassword&&this.formData.password&&(a.password=this.formData.password),await T.collection("uni-id-users").doc(i.userInfo._id).update({username:this.formData.account,nickname:this.formData.nickname}),await T.collection("Admin").where(`adminId == "${this.formDataId}"`).update(a),l({title:"更新成功",duration:2e3});this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>{o({delta:1})}),500)}catch(a){console.error("更新失败:",a),s({content:a.message||"更新失败",showCancel:!1})}finally{r()}}}},[["render",function(a,e,t,s,o,r){const i=n(d("uni-easyinput"),b),l=n(d("uni-forms-item"),_),T=c,y=n(d("uni-data-select"),V),v=w,L=D,I=n(d("uni-forms"),k);return f(),m(T,{class:"uni-container"},{default:u((()=>[h(I,{ref:"form",modelValue:o.formData,"onUpdate:modelValue":e[8]||(e[8]=a=>o.formData=a),rules:o.rules,validateTrigger:"bind",onSubmit:a.submit},{default:u((()=>[h(l,{name:"adminId",label:"管理员ID",required:""},{default:u((()=>[h(i,{modelValue:o.formData.adminId,"onUpdate:modelValue":e[0]||(e[0]=a=>o.formData.adminId=a),clearable:!1,disabled:""},null,8,["modelValue"])])),_:1}),h(l,{name:"account",label:"管理员账号",required:""},{default:u((()=>[h(i,{modelValue:o.formData.account,"onUpdate:modelValue":e[1]||(e[1]=a=>o.formData.account=a),clearable:!1,placeholder:"请输入管理员账号"},null,8,["modelValue"])])),_:1}),h(l,{name:"nickname",label:"管理员昵称",required:""},{default:u((()=>[h(i,{modelValue:o.formData.nickname,"onUpdate:modelValue":e[2]||(e[2]=a=>o.formData.nickname=a),clearable:!1,placeholder:"请输入管理员昵称"},null,8,["modelValue"])])),_:1}),o.showPassword?(f(),m(l,{name:"password",label:"重置密码",key:"password"},{default:u((()=>[h(i,{modelValue:o.formData.password,"onUpdate:modelValue":e[3]||(e[3]=a=>o.formData.password=a),type:"password",clearable:!1,placeholder:"请输入新密码"},{default:u((()=>[h(T,{slot:"right",class:"cancel-reset-password-btn",onClick:r.trigger},{default:u((()=>[p("取消")])),_:1},8,["onClick"])])),_:1},8,["modelValue"])])),_:1})):(f(),m(l,{key:1,label:"重置密码"},{default:u((()=>[g("span",{class:"reset-password-btn",onClick:e[4]||(e[4]=(...a)=>r.trigger&&r.trigger(...a))},"点击重置密码")])),_:1})),h(l,{name:"status",label:"账户状态",required:""},{default:u((()=>[h(y,{modelValue:o.formData.status,"onUpdate:modelValue":e[5]||(e[5]=a=>o.formData.status=a),localdata:o.statusOptions,clear:!1},null,8,["modelValue","localdata"])])),_:1}),h(l,{name:"registerTime",label:"注册时间"},{default:u((()=>[h(i,{modelValue:r.formattedRegisterTime,"onUpdate:modelValue":e[6]||(e[6]=a=>r.formattedRegisterTime=a),disabled:""},null,8,["modelValue"])])),_:1}),h(l,{name:"lastLoginTime",label:"最后登录"},{default:u((()=>[h(i,{modelValue:r.formattedLastLoginTime,"onUpdate:modelValue":e[7]||(e[7]=a=>r.formattedLastLoginTime=a),disabled:""},null,8,["modelValue"])])),_:1}),h(T,{class:"uni-button-group"},{default:u((()=>[h(v,{type:"primary",class:"uni-button",onClick:r.submitForm},{default:u((()=>[p("提交")])),_:1},8,["onClick"]),h(L,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:u((()=>[h(v,{class:"uni-button"},{default:u((()=>[p("返回")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-328acee8"]]);export{y as default};
