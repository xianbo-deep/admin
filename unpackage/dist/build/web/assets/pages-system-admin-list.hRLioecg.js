import{_ as e,e as t,n as a,s as n,q as i,r as s,a as r,c as o,w as l,i as c,b as d,d as u,f as g,g as h,o as m,h as f,k as p,l as b,m as C,F as _,I as y,p as T,t as x}from"./index-1tsbwzWw.js";import{_ as S}from"./uni-stat-breadcrumb.gfsZYonB.js";import{_ as z}from"./uni-tag.DJHF5HP_.js";import{_ as k}from"./uni-pagination.DVZKLAsf.js";import{_ as w}from"./unicloud-db.DwiPvpWe.js";const D=t.database(),$=["adminId","account","nickname"],I={ascending:"asc",descending:"desc"};const v=e({data:()=>({collection:"Admin",query:"",where:"",orderby:"lastLoginTime desc",selectedIndexs:[],options:{pageSize:20,pageCurrent:1},statusOptions:[{text:"正常",value:"active"},{text:"未激活",value:"inactive"},{text:"已禁用",value:"banned"}]}),onReady(){this.$refs.udb.loadData()},methods:{formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")}catch(t){return console.error("时间格式化错误:",t),""}},getStatusType:e=>({active:"success",inactive:"warning",banned:"error"}[e]||"default"),getStatusText:e=>({active:"正常",inactive:"未激活",banned:"已禁用"}[e]||e),onqueryload(e){e&&e.forEach((e=>{e.registerTime=e.registerTime||0,e.lastLoginTime=e.lastLoginTime||0}))},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return D.command.or($.map((e=>({[e]:t}))))},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},changeSize(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t=!0){a({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){const e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t].adminId))},delTable(){n({title:"确认删除",content:"是否删除选中的管理员？",success:e=>{e.confirm&&this.$refs.udb.remove(this.selectedItems(),{success:()=>{this.$refs.table.clearSelection(),i({title:"删除成功",icon:"success"})},fail:e=>{i({title:"删除失败",icon:"error"}),console.error(e)}})}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){n({title:"确认删除",content:"是否删除该管理员？",success:t=>{t.confirm&&this.$refs.udb.remove(e,{success:()=>{this.$refs.table.clearSelection(),i({title:"删除成功",icon:"success"})},fail:e=>{i({title:"删除失败",icon:"error"}),console.error(e)}})}})},sortChange(e,t){e.order?this.orderby=t+" "+I[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){e.filter&&e.filter.length?this.where={[t]:e.filter[0]}:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,n,i,D){const $=s(r("uni-stat-breadcrumb"),S),I=y,v=T,L=c,q=s(r("uni-th"),d),V=s(r("uni-tr"),u),j=s(r("uni-td"),g),P=s(r("uni-tag"),z),U=s(r("uni-table"),h),A=s(r("uni-pagination"),k),E=s(r("unicloud-db"),w);return m(),o(L,{class:"fix-top-window"},{default:l((()=>[f(L,{class:"uni-header"},{default:l((()=>[f($,{class:"uni-stat-breadcrumb-on-phone"}),f(L,{class:"uni-group"},{default:l((()=>[f(I,{class:"uni-search",type:"text",modelValue:i.query,"onUpdate:modelValue":t[0]||(t[0]=e=>i.query=e),onConfirm:D.search,placeholder:"搜索管理员..."},null,8,["modelValue","onConfirm"]),f(v,{class:"uni-button",type:"primary",size:"mini",onClick:D.search},{default:l((()=>[p("搜索")])),_:1},8,["onClick"]),f(v,{class:"uni-button",type:"warn",size:"mini",disabled:!i.selectedIndexs.length,onClick:D.delTable},{default:l((()=>[p("批量删除")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1}),f(L,{class:"uni-container"},{default:l((()=>[f(E,{ref:"udb",collection:i.collection,where:i.where,"page-data":"replace",orderby:i.orderby,getcount:!0,"page-size":i.options.pageSize,"page-current":i.options.pageCurrent,options:i.options,loadtime:"manual",onLoad:D.onqueryload},{default:l((({data:e,pagination:a,loading:n,error:s})=>[f(U,{ref:"table",loading:n,emptyText:s.message||"暂无数据",border:"",stripe:"",type:"selection",onSelectionChange:D.selectionChange},{default:l((()=>[f(V,null,{default:l((()=>[f(q,{align:"center",sortable:"",onSortChange:t[1]||(t[1]=e=>D.sortChange(e,"adminId"))},{default:l((()=>[p("管理员ID")])),_:1}),f(q,{align:"center",sortable:"",onSortChange:t[2]||(t[2]=e=>D.sortChange(e,"account"))},{default:l((()=>[p("账号")])),_:1}),f(q,{align:"center",sortable:"",onSortChange:t[3]||(t[3]=e=>D.sortChange(e,"nickname"))},{default:l((()=>[p("管理员名称")])),_:1}),f(q,{align:"center","filter-type":"select","filter-data":i.statusOptions,onFilterChange:t[4]||(t[4]=e=>D.filterChange(e,"status"))},{default:l((()=>[p("状态")])),_:1},8,["filter-data"]),f(q,{align:"center",sortable:"",onSortChange:t[5]||(t[5]=e=>D.sortChange(e,"registerTime"))},{default:l((()=>[p("注册时间")])),_:1}),f(q,{align:"center",sortable:"",onSortChange:t[6]||(t[6]=e=>D.sortChange(e,"lastLoginTime"))},{default:l((()=>[p("最后登录")])),_:1}),f(q,{align:"center"},{default:l((()=>[p("操作")])),_:1})])),_:1}),(m(!0),b(_,null,C(e,((e,t)=>(m(),o(V,{key:t},{default:l((()=>[f(j,{align:"center"},{default:l((()=>[p(x(e.adminId),1)])),_:2},1024),f(j,{align:"center"},{default:l((()=>[p(x(e.account),1)])),_:2},1024),f(j,{align:"center"},{default:l((()=>[p(x(e.nickname),1)])),_:2},1024),f(j,{align:"center"},{default:l((()=>[f(P,{type:D.getStatusType(e.status),text:D.getStatusText(e.status)},null,8,["type","text"])])),_:2},1024),f(j,{align:"center"},{default:l((()=>[p(x(D.formatDateTime(e.registerTime)),1)])),_:2},1024),f(j,{align:"center"},{default:l((()=>[p(x(D.formatDateTime(e.lastLoginTime)),1)])),_:2},1024),f(j,{align:"center"},{default:l((()=>[f(L,{class:"uni-group"},{default:l((()=>[f(v,{onClick:t=>D.navigateTo("./edit?id="+e.adminId,!1),class:"uni-button",size:"mini",type:"primary"},{default:l((()=>[p("编辑")])),_:2},1032,["onClick"]),f(v,{onClick:t=>D.confirmDelete(e.adminId),class:"uni-button",size:"mini",type:"warn"},{default:l((()=>[p("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),f(L,{class:"uni-pagination-box"},{default:l((()=>[f(A,{"show-icon":"","show-page-size":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:D.onPageChanged,onPageSizeChange:D.changeSize},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange","onPageSizeChange"])])),_:2},1024)])),_:1},8,["collection","where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}],["__scopeId","data-v-6c04ec2a"]]);export{v as default};
