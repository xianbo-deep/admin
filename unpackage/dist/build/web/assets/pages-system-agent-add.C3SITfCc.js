import{_ as e,e as a,N as t,s as o,q as i,H as r,O as l,r as d,a as s,c as n,w as m,i as u,o as f,h,k as c,t as p,M as g,p as D}from"./index-1tsbwzWw.js";import{_ as I}from"./uni-easyinput.B-y-wvYA.js";import{_ as w}from"./uni-forms-item.C04_D_PQ.js";import{_}from"./uni-forms.Cx-ojO0j.js";const P=a.database(),V=["GET","POST","PUT","DELETE"];const k=e({data:()=>({id:"",methodIndex:1,methodOptions:V,formData:{agentId:"",identifier:"",apiPath:"",method:"POST",authorization:"",workflowId:"",description:"",status:"active"},rules:{agentId:{rules:[{required:!0,errorMessage:"请输入Agent ID"},{pattern:"^[a-zA-Z0-9_-]+$",errorMessage:"Agent ID只能包含字母、数字、下划线和连字符"}]},identifier:{rules:[{required:!0,errorMessage:"请输入标识符"}]},apiPath:{rules:[{required:!0,errorMessage:"请输入API路径"}]},authorization:{rules:[{required:!0,errorMessage:"请输入API授权令牌"}]},workflowId:{rules:[{required:!0,errorMessage:"请输入工作流ID"}]}}}),onLoad(e){e.id&&(this.id=e.id,this.getDetail())},methods:{onMethodChange(e){const a=e.detail.value;this.methodIndex=a,this.formData.method=this.methodOptions[a]},async submitForm(){try{if(!(await this.$refs.form.validate()))return;t({title:this.id?"修改中...":"新增中..."});const a={agentId:this.formData.agentId.trim(),identifier:this.formData.identifier.trim(),apiPath:this.formData.apiPath.trim(),method:this.formData.method,authorization:this.formData.authorization.trim(),workflowId:this.formData.workflowId.trim(),description:this.formData.description||"",status:this.formData.status};if(this.id)await P.collection("Agent").doc(this.id).update(a),i({title:"修改成功"});else try{const e=await P.collection("Agent").where({agentId:a.agentId}).get();if(((null==e?void 0:e.data)||[]).length>0)return void o({content:"Agent ID已存在",showCancel:!1});await P.collection("Agent").add(a),i({title:"新增成功"})}catch(e){return void o({content:e.message||"新增失败",showCancel:!1})}this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>r()),500)}catch(a){o({content:a.message||"操作失败",showCancel:!1})}finally{l()}},async getDetail(){try{t({mask:!0});const{data:e}=await P.collection("Agent").doc(this.id).field("agentId,identifier,apiPath,method,authorization,workflowId,description,status").get();e[0]&&(this.formData=e[0],this.methodIndex=this.methodOptions.indexOf(e[0].method||"POST"))}catch(e){o({content:e.message||"获取详情失败",showCancel:!1})}finally{l()}},goBack(){r()}}},[["render",function(e,a,t,o,i,r){const l=d(s("uni-easyinput"),I),P=d(s("uni-forms-item"),w),V=u,k=g,A=D,b=d(s("uni-forms"),_);return f(),n(V,{class:"container"},{default:m((()=>[h(b,{ref:"form",model:i.formData,rules:i.rules},{default:m((()=>[h(P,{label:"Agent ID",name:"agentId",required:""},{default:m((()=>[h(l,{modelValue:i.formData.agentId,"onUpdate:modelValue":a[0]||(a[0]=e=>i.formData.agentId=e),placeholder:"请输入Agent ID",disabled:!!i.id},null,8,["modelValue","disabled"])])),_:1}),h(P,{label:"标识符",name:"identifier",required:""},{default:m((()=>[h(l,{modelValue:i.formData.identifier,"onUpdate:modelValue":a[1]||(a[1]=e=>i.formData.identifier=e),placeholder:"请输入标识符"},null,8,["modelValue"])])),_:1}),h(P,{label:"API路径",name:"apiPath",required:""},{default:m((()=>[h(l,{modelValue:i.formData.apiPath,"onUpdate:modelValue":a[2]||(a[2]=e=>i.formData.apiPath=e),placeholder:"请输入API路径"},null,8,["modelValue"])])),_:1}),h(P,{label:"请求方式",name:"method"},{default:m((()=>[h(V,{class:"select-box"},{default:m((()=>[h(k,{onChange:r.onMethodChange,value:i.methodIndex,range:i.methodOptions},{default:m((()=>[h(V,{class:"picker-view"},{default:m((()=>[c(p(i.formData.method||"POST"),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),h(P,{label:"API授权令牌",name:"authorization",required:""},{default:m((()=>[h(l,{modelValue:i.formData.authorization,"onUpdate:modelValue":a[3]||(a[3]=e=>i.formData.authorization=e),type:"password",placeholder:"请输入API授权令牌"},null,8,["modelValue"])])),_:1}),h(P,{label:"工作流ID",name:"workflowId",required:""},{default:m((()=>[h(l,{modelValue:i.formData.workflowId,"onUpdate:modelValue":a[4]||(a[4]=e=>i.formData.workflowId=e),placeholder:"请输入工作流ID"},null,8,["modelValue"])])),_:1}),h(P,{label:"描述",name:"description"},{default:m((()=>[h(l,{type:"textarea",modelValue:i.formData.description,"onUpdate:modelValue":a[5]||(a[5]=e=>i.formData.description=e),placeholder:"请输入描述信息"},null,8,["modelValue"])])),_:1}),h(V,{class:"btn-group"},{default:m((()=>[h(A,{onClick:r.submitForm,type:"primary",class:"btn"},{default:m((()=>[c("提交")])),_:1},8,["onClick"]),h(A,{onClick:r.goBack,class:"btn"},{default:m((()=>[c("返回")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])),_:1})}],["__scopeId","data-v-fe0c0eae"]]);export{k as default};
