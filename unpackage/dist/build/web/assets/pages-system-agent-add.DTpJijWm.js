import{_ as e,e as a,N as t,s as i,q as r,H as s,O as o,r as l,a as n,c as d,w as m,i as u,o as c,h as f,k as h,p}from"./index-BQ2OFzYe.js";import{_ as g}from"./uni-easyinput.VVN8Z8n5.js";import{_ as D}from"./uni-forms-item.O5OP8sj5.js";import{_ as I}from"./uni-forms.CeWDBJu8.js";const _=a.database();const A=e({data:()=>({id:"",formData:{agentId:"",identifier:"",apiPath:"",description:"",status:"normal"},rules:{agentId:{rules:[{required:!0,errorMessage:"请输入Agent ID"},{pattern:"^[a-zA-Z0-9_-]+$",errorMessage:"Agent ID只能包含字母、数字、下划线和连字符"}]},identifier:{rules:[{required:!0,errorMessage:"请输入标识符"}]},apiPath:{rules:[{required:!0,errorMessage:"请输入API路径"}]}}}),onLoad(e){e.id&&(this.id=e.id,this.getDetail())},methods:{async submitForm(){try{if(!(await this.$refs.form.validate()))return;t({title:this.id?"修改中...":"新增中..."});const a={agentId:this.formData.agentId.trim(),identifier:this.formData.identifier.trim(),apiPath:this.formData.apiPath.trim(),description:this.formData.description||"",status:this.formData.status};if(this.id)await _.collection("Agent").doc(this.id).update(a),r({title:"修改成功"});else try{const e=await _.collection("Agent").where({agentId:a.agentId}).get();if(((null==e?void 0:e.data)||[]).length>0)return void i({content:"Agent ID已存在",showCancel:!1});await _.collection("Agent").add(a),r({title:"新增成功"})}catch(e){return void i({content:e.message||"新增失败",showCancel:!1})}this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>s()),500)}catch(a){i({content:a.message||"操作失败",showCancel:!1})}finally{o()}},async getDetail(){try{t({mask:!0});const{data:e}=await _.collection("Agent").doc(this.id).field("agentId,identifier,apiPath,description,status").get();e[0]&&(this.formData=e[0])}catch(e){i({content:e.message||"获取详情失败",showCancel:!1})}finally{o()}},goBack(){s()}}},[["render",function(e,a,t,i,r,s){const o=l(n("uni-easyinput"),g),_=l(n("uni-forms-item"),D),A=p,b=u,w=l(n("uni-forms"),I);return c(),d(b,{class:"container"},{default:m((()=>[f(w,{ref:"form",model:r.formData,rules:r.rules},{default:m((()=>[f(_,{label:"Agent ID",name:"agentId",required:""},{default:m((()=>[f(o,{modelValue:r.formData.agentId,"onUpdate:modelValue":a[0]||(a[0]=e=>r.formData.agentId=e),placeholder:"请输入Agent ID",disabled:!!r.id},null,8,["modelValue","disabled"])])),_:1}),f(_,{label:"标识符",name:"identifier",required:""},{default:m((()=>[f(o,{modelValue:r.formData.identifier,"onUpdate:modelValue":a[1]||(a[1]=e=>r.formData.identifier=e),placeholder:"请输入标识符"},null,8,["modelValue"])])),_:1}),f(_,{label:"API路径",name:"apiPath",required:""},{default:m((()=>[f(o,{modelValue:r.formData.apiPath,"onUpdate:modelValue":a[2]||(a[2]=e=>r.formData.apiPath=e),placeholder:"请输入API路径"},null,8,["modelValue"])])),_:1}),f(_,{label:"描述",name:"description"},{default:m((()=>[f(o,{type:"textarea",modelValue:r.formData.description,"onUpdate:modelValue":a[3]||(a[3]=e=>r.formData.description=e),placeholder:"请输入描述信息"},null,8,["modelValue"])])),_:1}),f(b,{class:"btn-group"},{default:m((()=>[f(A,{onClick:s.submitForm,type:"primary",class:"btn"},{default:m((()=>[h("提交")])),_:1},8,["onClick"]),f(A,{onClick:s.goBack,class:"btn"},{default:m((()=>[h("返回")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])),_:1})}],["__scopeId","data-v-6a299aca"]]);export{A as default};
