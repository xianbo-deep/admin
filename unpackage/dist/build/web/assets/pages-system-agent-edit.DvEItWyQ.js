import{_ as e,e as a,N as t,s as i,O as s,q as l,H as r,r as n,a as o,c as d,w as m,i as u,o as c,h as f,k as h,p,Z as g}from"./index-BQ2OFzYe.js";import{_ as D}from"./uni-easyinput.VVN8Z8n5.js";import{_ as b}from"./uni-forms-item.O5OP8sj5.js";import{_ as I}from"./uni-forms.CeWDBJu8.js";const _=a.database();const V=e({data:()=>({formDataId:"",formData:{agentId:"",identifier:"",apiPath:"",description:"",status:"normal"},rules:{agentId:{rules:[{required:!0,errorMessage:"请输入Agent ID"},{pattern:"^[a-zA-Z0-9_-]+$",errorMessage:"Agent ID只能包含字母、数字、下划线和连字符"}]},identifier:{rules:[{required:!0,errorMessage:"请输入标识符"}]},apiPath:{rules:[{required:!0,errorMessage:"请输入API路径"}]}}}),onLoad(e){e.id&&(this.formDataId=e.id,this.getDetail(e.id))},methods:{submitForm(){this.$refs.form.submit()},submit(e){const{value:a,errors:l}=e.detail;l||(t({title:this.formDataId?"修改中...":"新增中...",mask:!0}),this.formDataId?this.submitData(a):_.collection("Agent").where({agentId:a.agentId}).get().then((e=>{e.result.data.length>0?(i({content:"Agent ID已存在",showCancel:!1}),s()):this.submitData(a)})).catch((e=>{s(),i({content:e.message||"请求服务失败",showCancel:!1})})))},submitData(e){var a;const t={agentId:e.agentId.trim(),identifier:e.identifier.trim(),apiPath:e.apiPath.trim(),description:(null==(a=e.description)?void 0:a.trim())||"",status:e.status||"normal"};this.formDataId?_.collection("Agent").doc(this.formDataId).update(t).then((()=>{l({title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>r()),500)})).catch((e=>{i({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{s()})):_.collection("Agent").add(t).then((()=>{l({title:"新增成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>r()),500)})).catch((e=>{i({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{s()}))},getDetail(e){t({mask:!0}),_.collection("Agent").doc(e).field("agentId,identifier,apiPath,description,status").get().then((e=>{const a=e.result.data[0];a&&(this.formData=Object.assign({},this.formData,a))})).catch((e=>{i({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{s()}))}}},[["render",function(e,a,t,i,s,l){const r=n(o("uni-easyinput"),D),_=n(o("uni-forms-item"),b),V=p,A=g,y=u,P=n(o("uni-forms"),I);return c(),d(y,{class:"uni-container"},{default:m((()=>[f(P,{ref:"form",modelValue:s.formData,"onUpdate:modelValue":a[4]||(a[4]=e=>s.formData=e),rules:s.rules,validateTrigger:"bind",onSubmit:l.submit},{default:m((()=>[f(_,{name:"agentId",label:"Agent ID",required:""},{default:m((()=>[f(r,{modelValue:s.formData.agentId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.formData.agentId=e),clearable:!1,placeholder:"请输入Agent ID",disabled:!!s.formDataId},null,8,["modelValue","disabled"])])),_:1}),f(_,{name:"identifier",label:"标识符",required:""},{default:m((()=>[f(r,{modelValue:s.formData.identifier,"onUpdate:modelValue":a[1]||(a[1]=e=>s.formData.identifier=e),clearable:!1,placeholder:"请输入标识符"},null,8,["modelValue"])])),_:1}),f(_,{name:"apiPath",label:"API路径",required:""},{default:m((()=>[f(r,{modelValue:s.formData.apiPath,"onUpdate:modelValue":a[2]||(a[2]=e=>s.formData.apiPath=e),clearable:!1,placeholder:"请输入API路径"},null,8,["modelValue"])])),_:1}),f(_,{name:"description",label:"描述"},{default:m((()=>[f(r,{type:"textarea",modelValue:s.formData.description,"onUpdate:modelValue":a[3]||(a[3]=e=>s.formData.description=e),placeholder:"请输入描述"},null,8,["modelValue"])])),_:1}),f(y,{class:"uni-button-group"},{default:m((()=>[f(V,{style:{width:"100px"},type:"primary",class:"uni-button",onClick:l.submitForm},{default:m((()=>[h("提交")])),_:1},8,["onClick"]),f(A,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:m((()=>[f(V,{style:{width:"100px"},class:"uni-button"},{default:m((()=>[h("返回")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-69d4eb82"]]);export{V as default};
