import{_ as e,e as a,N as t,s as o,O as l,q as i,H as r,r as n,a as d,c as s,w as m,i as u,o as h,h as f,k as c,t as p,M as g,p as I,Z as D}from"./index-1tsbwzWw.js";import{_ as b}from"./uni-easyinput.B-y-wvYA.js";import{_ as w}from"./uni-forms-item.C04_D_PQ.js";import{_}from"./uni-forms.Cx-ojO0j.js";const V=a.database(),P=["GET","POST","PUT","DELETE"];const A=e({data:()=>({formDataId:"",methodIndex:1,methodOptions:P,formData:{agentId:"",identifier:"",apiPath:"",method:"POST",authorization:"",workflowId:"",description:"",status:"active"},rules:{agentId:{rules:[{required:!0,errorMessage:"请输入Agent ID"},{pattern:"^[a-zA-Z0-9_-]+$",errorMessage:"Agent ID只能包含字母、数字、下划线和连字符"}]},identifier:{rules:[{required:!0,errorMessage:"请输入标识符"}]},apiPath:{rules:[{required:!0,errorMessage:"请输入API路径"}]},authorization:{rules:[{required:!0,errorMessage:"请输入API授权令牌"}]},workflowId:{rules:[{required:!0,errorMessage:"请输入工作流ID"}]}}}),onLoad(e){e.id&&(this.formDataId=e.id,this.getDetail(e.id))},methods:{onMethodChange(e){const a=e.detail.value;this.methodIndex=a,this.formData.method=this.methodOptions[a]},submitForm(){this.$refs.form.submit()},submit(e){const{value:a,errors:i}=e.detail;i||(t({title:this.formDataId?"修改中...":"新增中...",mask:!0}),this.formDataId?this.submitData(a):V.collection("Agent").where({agentId:a.agentId}).get().then((e=>{e.result.data.length>0?(o({content:"Agent ID已存在",showCancel:!1}),l()):this.submitData(a)})).catch((e=>{l(),o({content:e.message||"请求服务失败",showCancel:!1})})))},submitData(e){var a;const t={agentId:e.agentId.trim(),identifier:e.identifier.trim(),apiPath:e.apiPath.trim(),method:e.method||"POST",authorization:e.authorization.trim(),workflowId:e.workflowId.trim(),description:(null==(a=e.description)?void 0:a.trim())||"",status:e.status||"active"};this.formDataId?V.collection("Agent").doc(this.formDataId).update(t).then((()=>{i({title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>r()),500)})).catch((e=>{o({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{l()})):V.collection("Agent").add(t).then((()=>{i({title:"新增成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>r()),500)})).catch((e=>{o({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{l()}))},getDetail(e){t({mask:!0}),V.collection("Agent").doc(e).field("agentId,identifier,apiPath,method,authorization,workflowId,description,status").get().then((e=>{const a=e.result.data[0];a&&(this.formData=Object.assign({},this.formData,a),this.methodIndex=this.methodOptions.indexOf(a.method||"POST"))})).catch((e=>{o({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{l()}))}}},[["render",function(e,a,t,o,l,i){const r=n(d("uni-easyinput"),b),V=n(d("uni-forms-item"),w),P=u,A=g,k=I,O=D,v=n(d("uni-forms"),_);return h(),s(P,{class:"uni-container"},{default:m((()=>[f(v,{ref:"form",modelValue:l.formData,"onUpdate:modelValue":a[6]||(a[6]=e=>l.formData=e),rules:l.rules,validateTrigger:"bind",onSubmit:i.submit},{default:m((()=>[f(V,{name:"agentId",label:"Agent ID",required:""},{default:m((()=>[f(r,{modelValue:l.formData.agentId,"onUpdate:modelValue":a[0]||(a[0]=e=>l.formData.agentId=e),clearable:!1,placeholder:"请输入Agent ID",disabled:!!l.formDataId},null,8,["modelValue","disabled"])])),_:1}),f(V,{name:"identifier",label:"标识符",required:""},{default:m((()=>[f(r,{modelValue:l.formData.identifier,"onUpdate:modelValue":a[1]||(a[1]=e=>l.formData.identifier=e),clearable:!1,placeholder:"请输入标识符"},null,8,["modelValue"])])),_:1}),f(V,{name:"apiPath",label:"API路径",required:""},{default:m((()=>[f(r,{modelValue:l.formData.apiPath,"onUpdate:modelValue":a[2]||(a[2]=e=>l.formData.apiPath=e),clearable:!1,placeholder:"请输入API路径"},null,8,["modelValue"])])),_:1}),f(V,{name:"method",label:"请求方式"},{default:m((()=>[f(P,{class:"select-box"},{default:m((()=>[f(A,{onChange:i.onMethodChange,value:l.methodIndex,range:l.methodOptions},{default:m((()=>[f(P,{class:"picker-item"},{default:m((()=>[c(p(l.formData.method||"POST"),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),f(V,{name:"authorization",label:"API授权令牌",required:""},{default:m((()=>[f(r,{type:"password",modelValue:l.formData.authorization,"onUpdate:modelValue":a[3]||(a[3]=e=>l.formData.authorization=e),clearable:!1,placeholder:"请输入API授权令牌"},null,8,["modelValue"])])),_:1}),f(V,{name:"workflowId",label:"工作流ID",required:""},{default:m((()=>[f(r,{modelValue:l.formData.workflowId,"onUpdate:modelValue":a[4]||(a[4]=e=>l.formData.workflowId=e),clearable:!1,placeholder:"请输入工作流ID"},null,8,["modelValue"])])),_:1}),f(V,{name:"description",label:"描述"},{default:m((()=>[f(r,{type:"textarea",modelValue:l.formData.description,"onUpdate:modelValue":a[5]||(a[5]=e=>l.formData.description=e),placeholder:"请输入描述"},null,8,["modelValue"])])),_:1}),f(P,{class:"uni-button-group"},{default:m((()=>[f(k,{style:{width:"100px"},type:"primary",class:"uni-button",onClick:i.submitForm},{default:m((()=>[c("提交")])),_:1},8,["onClick"]),f(O,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:m((()=>[f(k,{style:{width:"100px"},class:"uni-button"},{default:m((()=>[c("返回")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-6a19f283"]]);export{A as default};
