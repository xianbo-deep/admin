import{_ as e,e as t,n as a,s as n,q as i,r as s,a as o,c as l,w as r,i as d,b as c,d as u,f as g,g as h,o as p,h as f,k as m,l as y,m as b,F as _,I as C,p as x,t as w}from"./index-BQ2OFzYe.js";import{_ as z}from"./uni-stat-breadcrumb.DHkfubMW.js";import{_ as I}from"./uni-tag.AKI94Qn2.js";import{_ as k}from"./uni-pagination.Bz9-uLqg.js";import{_ as S}from"./unicloud-db.C6t2K4BA.js";const D=t.database();D.command;const $=["agentId","identifier","description"],A={ascending:"asc",descending:"desc"};const T=e({data:()=>({query:"",where:"",orderby:"agentId asc",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1},data:[]}),mounted(){this.loadData()},methods:{getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return D.command.or($.map((e=>({[e]:t}))))},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},navigateTo(e,t=!0){e&&a({url:e,events:{refreshData:()=>{this.loadData(t)}}})},changeSize(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb&&this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs=[],this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+A[e.order]:this.orderby="agentId asc",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},onqueryload(e){this.data=Array.isArray(e)?e:e.data||[]},async toggleStatus(e){if(!e||!e._id)return;const t="normal"===e.status?"disabled":"normal",a="normal"===t?"启用":"禁用";n({title:"提示",content:`确认${a}该Agent？`,success:async n=>{if(n.confirm)try{await D.collection("Agent").doc(e._id).update({status:t}),this.loadData(!0),i({title:`${a}成功`,icon:"success"})}catch(s){console.error(`${a}失败:`,s),i({title:`${a}失败`,icon:"error"})}}})},selectedItems(){return this.data&&this.selectedIndexs?this.selectedIndexs.map((e=>this.data[e]._id)).filter(Boolean):[]},async delTable(){const e=this.selectedItems();if(e.length)try{n({title:"提示",content:"是否确认删除选中的记录？",success:async t=>{var a;if(t.confirm){const t=await D.startTransaction();try{const n=e.map((e=>t.collection("Agent").doc(e).remove()));await Promise.all(n),await t.commit(),this.selectedIndexs=[],null==(a=this.$refs.table)||a.clearSelection(),this.loadData(!0),i({title:"删除成功",icon:"success"})}catch(n){throw await t.rollback(),n}}}})}catch(t){console.error("删除失败:",t),i({title:"删除失败",icon:"error"})}},selectionChange(e){e&&e.detail&&Array.isArray(e.detail.index)&&(this.selectedIndexs=e.detail.index)},async confirmDelete(e){e&&n({title:"提示",content:"是否确认删除该Agent？",success:async t=>{if(t.confirm)try{await D.collection("Agent").doc(e).remove(),this.loadData(!0),i({title:"删除成功",icon:"success"})}catch(a){console.error("删除失败:",a),i({title:"删除失败",icon:"error"})}}})}}},[["render",function(e,t,a,n,i,D){const $=s(o("uni-stat-breadcrumb"),z),A=C,T=x,P=d,v=s(o("uni-th"),c),q=s(o("uni-tr"),u),V=s(o("uni-td"),g),j=s(o("uni-tag"),I),B=s(o("uni-table"),h),F=s(o("uni-pagination"),k),U=s(o("unicloud-db"),S);return p(),l(P,{class:"fix-top-window"},{default:r((()=>[f(P,{class:"uni-header"},{default:r((()=>[f($,{class:"uni-stat-breadcrumb-on-phone"}),f(P,{class:"uni-group"},{default:r((()=>[f(A,{class:"uni-search",type:"text",modelValue:i.query,"onUpdate:modelValue":t[0]||(t[0]=e=>i.query=e),onConfirm:D.search,placeholder:"搜索Agent..."},null,8,["modelValue","onConfirm"]),f(T,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:D.search},{default:r((()=>[m("搜索")])),_:1},8,["onClick"]),f(T,{class:"uni-button",type:"primary",size:"mini",onClick:t[1]||(t[1]=e=>D.navigateTo("./add"))},{default:r((()=>[m("新增")])),_:1}),f(T,{class:"uni-button",type:"warn",size:"mini",disabled:!i.selectedIndexs.length,onClick:D.delTable},{default:r((()=>[m("批量删除")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1}),f(P,{class:"uni-container"},{default:r((()=>[f(U,{ref:"udb",collection:"Agent",field:"agentId,identifier,description,apiPath,status",where:i.where,"page-data":"replace",getcount:!0,"page-size":i.options.pageSize,"page-current":i.options.pageCurrent,orderby:i.orderby,loadtime:"manual",onLoad:D.onqueryload},{default:r((({pagination:e,loading:a,error:n})=>[f(B,{ref:"table",loading:a,emptyText:n.message||"没有数据",border:"",stripe:"",type:"selection",onSelectionChange:D.selectionChange},{default:r((()=>[f(q,null,{default:r((()=>[f(v,{align:"center",sortable:"",onSortChange:t[2]||(t[2]=e=>D.sortChange(e,"agentId"))},{default:r((()=>[m("Agent ID")])),_:1}),f(v,{align:"center",sortable:"",onSortChange:t[3]||(t[3]=e=>D.sortChange(e,"identifier"))},{default:r((()=>[m("标识符")])),_:1}),f(v,{align:"center"},{default:r((()=>[m("描述信息")])),_:1}),f(v,{align:"center"},{default:r((()=>[m("API路径")])),_:1}),f(v,{align:"center",sortable:"",onSortChange:t[4]||(t[4]=e=>D.sortChange(e,"status"))},{default:r((()=>[m("状态")])),_:1}),f(v,{align:"center"},{default:r((()=>[m("操作")])),_:1})])),_:1}),(p(!0),y(_,null,b(i.data,((e,t)=>(p(),l(q,{key:e._id},{default:r((()=>[f(V,{align:"center"},{default:r((()=>[m(w(e.agentId),1)])),_:2},1024),f(V,{align:"center"},{default:r((()=>[m(w(e.identifier),1)])),_:2},1024),f(V,{align:"center"},{default:r((()=>[f(P,{class:"ellipsis",title:e.description},{default:r((()=>[m(w(e.description||"-"),1)])),_:2},1032,["title"])])),_:2},1024),f(V,{align:"center"},{default:r((()=>[f(P,{class:"ellipsis",title:e.apiPath},{default:r((()=>[m(w(e.apiPath),1)])),_:2},1032,["title"])])),_:2},1024),f(V,{align:"center"},{default:r((()=>[f(j,{text:"normal"===e.status?"正常":"禁用",type:"normal"===e.status?"success":"error"},null,8,["text","type"])])),_:2},1024),f(V,{align:"center"},{default:r((()=>[f(P,{class:"uni-group"},{default:r((()=>[f(T,{onClick:t=>D.toggleStatus(e),class:"uni-button",size:"mini",type:"normal"===e.status?"warning":"primary"},{default:r((()=>[m(w("normal"===e.status?"禁用":"启用"),1)])),_:2},1032,["onClick","type"]),f(T,{onClick:t=>D.navigateTo("./edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:r((()=>[m("编辑")])),_:2},1032,["onClick"]),f(T,{onClick:t=>D.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:r((()=>[m("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),f(P,{class:"uni-pagination-box"},{default:r((()=>[f(F,{"show-icon":"","show-page-size":"","page-size":e.size,modelValue:e.current,"onUpdate:modelValue":t=>e.current=t,total:e.count,onChange:D.onPageChanged,onPageSizeChange:D.changeSize},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange","onPageSizeChange"])])),_:2},1024)])),_:1},8,["where","page-size","page-current","orderby","onLoad"])])),_:1})])),_:1})}],["__scopeId","data-v-7885da4c"]]);export{T as default};
