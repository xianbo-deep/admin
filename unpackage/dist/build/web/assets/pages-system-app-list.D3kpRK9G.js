import{_ as e,e as t,G as a,s as i,n,r as o,a as s,c as l,w as d,i as r,b as p,d as c,f as u,g as h,o as g,h as m,k as f,t as b,l as C,m as _,F as y,I as x,p as $,v as w}from"./index-BQ2OFzYe.js";import{_ as z}from"./uni-stat-breadcrumb.DHkfubMW.js";import{_ as k}from"./uni-dateformat.C3vwkADr.js";import{_ as S}from"./uni-pagination.Bz9-uLqg.js";import{_ as D}from"./unicloud-db.C6t2K4BA.js";import{e as T,f as v}from"./opendb-app-list.BrPUIYpy.js";const I=t.database(),j=[],A={ascending:"asc",descending:"desc"};const F=e({data:()=>({query:"",where:"",orderby:"create_date",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{},...T},imageStyles:{width:64,height:64},exportExcel:{filename:"opendb-app-list.xls",type:"xls",fields:{AppID:"appid","应用名称":"name","应用描述":"description","创建时间":"create_date"}},exportExcelData:[],addAppidLoading:!0,descriptionThWidth:380,buttonThWidth:400}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},computed:{...a("app",["appName","appid"])},methods:{pageSizeChange(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},onqueryload(e){e.find((e=>e.appid===this.appid))?this.addAppidLoading=!1:this.addCurrentAppid({appid:this.appid,name:this.appName,description:"admin 管理后台"}),this.exportExcelData=e},changeSize(e){this.pageSizeIndex=e.detail.value},addCurrentAppid(e){I.collection("opendb-app-list").add(e).then((e=>{this.loadData(),setTimeout((()=>{i({content:`检测到数据库中无当前应用, 已自动添加应用: ${this.appName}`,showCancel:!1})}),500)})).catch((e=>{})).finally((()=>{this.addAppidLoading=!1}))},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return j.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){n({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){let e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){console.warn("删除应用，只能删除应用表 opendb-app-list 中的应用数据记录，不能删除与应用关联的其他数据，例如：使用升级中心 uni-upgrade-center 等插件产生的数据（应用版本数据等）"),this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){console.warn("删除应用，只能删除应用表 opendb-app-list 中的应用数据记录，不能删除与应用关联的其他数据，例如：使用升级中心 uni-upgrade-center 等插件产生的数据（应用版本数据等）"),this.$refs.udb.remove(e,{confirmContent:"是否删除该应用",success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+A[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=v(this._filter,I.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))},publish(e){n({url:"/pages/system/app/uni-portal/uni-portal?id="+e})}}},[["render",function(e,t,a,i,n,T){const v=o(s("uni-stat-breadcrumb"),z),I=x,j=$,A=r,F=o(s("uni-th"),p),L=o(s("uni-tr"),c),q=o(s("uni-td"),u),V=w,W=o(s("uni-dateformat"),k),N=o(s("uni-table"),h),E=o(s("uni-pagination"),S),P=o(s("unicloud-db"),D);return g(),l(A,{class:"fix-top-window"},{default:d((()=>[m(A,{class:"uni-header"},{default:d((()=>[m(v,{class:"uni-stat-breadcrumb-on-phone"}),m(A,{class:"uni-group"},{default:d((()=>[m(I,{class:"uni-search",type:"text",modelValue:n.query,"onUpdate:modelValue":t[0]||(t[0]=e=>n.query=e),onConfirm:T.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),m(j,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:T.search},{default:d((()=>[f(b(e.$t("common.button.search")),1)])),_:1},8,["onClick"]),m(j,{class:"uni-button",type:"primary",size:"mini",onClick:t[1]||(t[1]=e=>T.navigateTo("./add"))},{default:d((()=>[f(b(e.$t("common.button.add")),1)])),_:1}),m(j,{class:"uni-button",type:"warn",size:"mini",disabled:!n.selectedIndexs.length,onClick:T.delTable},{default:d((()=>[f(b(e.$t("common.button.batchDelete")),1)])),_:1},8,["disabled","onClick"])])),_:1})])),_:1}),m(A,{class:"uni-container"},{default:d((()=>[m(P,{ref:"udb",collection:"opendb-app-list",field:"appid,name,description,remark,create_date",where:n.where,"page-data":"replace",orderby:n.orderby,getcount:!0,"page-size":n.options.pageSize,"page-current":n.options.pageCurrent,options:n.options,loadtime:"manual",onLoad:T.onqueryload},{default:d((({data:a,pagination:i,loading:o,error:s,options:r})=>[m(N,{ref:"table",loading:o||n.addAppidLoading,emptyText:s.message||e.$t("common.empty"),border:"",stripe:"",type:"selection",onSelectionChange:T.selectionChange,class:"table-pc"},{default:d((()=>[m(L,null,{default:d((()=>[m(F,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>T.filterChange(e,"appid")),sortable:"",onSortChange:t[3]||(t[3]=e=>T.sortChange(e,"appid"))},{default:d((()=>[f("AppID")])),_:1}),m(F,{align:"center","filter-type":"search",onFilterChange:t[4]||(t[4]=e=>T.filterChange(e,"name")),sortable:"",onSortChange:t[5]||(t[5]=e=>T.sortChange(e,"name"))},{default:d((()=>[f("应用名称")])),_:1}),m(F,{align:"center","filter-type":"search",onFilterChange:t[6]||(t[6]=e=>T.filterChange(e,"description")),sortable:"",onSortChange:t[7]||(t[7]=e=>T.sortChange(e,"description")),width:n.descriptionThWidth},{default:d((()=>[f("应用描述 ")])),_:1},8,["width"]),m(F,{align:"center"},{default:d((()=>[f("应用备注")])),_:1}),m(F,{align:"center","filter-type":"timestamp",onFilterChange:t[8]||(t[8]=e=>T.filterChange(e,"create_date")),sortable:"",onSortChange:t[9]||(t[9]=e=>T.sortChange(e,"create_date"))},{default:d((()=>[f("创建时间")])),_:1}),m(F,{align:"center",width:n.buttonThWidth},{default:d((()=>[f("操作")])),_:1},8,["width"])])),_:1}),(g(!0),C(y,null,_(a,((t,a)=>(g(),l(L,{key:a,disabled:t.appid===e.appid},{default:d((()=>[m(q,{align:"center"},{default:d((()=>[f(b(t.appid),1)])),_:2},1024),m(q,{align:"center"},{default:d((()=>[f(b(t.name),1)])),_:2},1024),m(q,{align:"left"},{default:d((()=>[m(V,null,{default:d((()=>[f(b(t.description||"-"),1)])),_:2},1024)])),_:2},1024),m(q,{align:"left"},{default:d((()=>[m(V,null,{default:d((()=>[f(b(t.remark||"-"),1)])),_:2},1024)])),_:2},1024),m(q,{align:"center"},{default:d((()=>[m(W,{threshold:[0,0],date:t.create_date},null,8,["date"])])),_:2},1024),m(q,{align:"center"},{default:d((()=>[m(A,{class:"uni-group"},{default:d((()=>[m(j,{onClick:e=>T.publish(t._id),class:"uni-button",size:"mini",type:"primary"},{default:d((()=>[f(b(e.$t("common.button.publish")),1)])),_:2},1032,["onClick"]),m(j,{onClick:e=>T.navigateTo("/uni_modules/uni-upgrade-center/pages/version/list?appid="+t.appid,!1),class:"uni-button",size:"mini",type:"primary"},{default:d((()=>[f(b(e.$t("common.button.version")),1)])),_:2},1032,["onClick"]),m(j,{onClick:e=>T.navigateTo("./add?id="+t.appid,!1),class:"uni-button",size:"mini",type:"primary"},{default:d((()=>[f(b(e.$t("common.button.edit")),1)])),_:2},1032,["onClick"]),m(j,{onClick:e=>T.confirmDelete(t._id),class:"uni-button",size:"mini",type:"warn"},{default:d((()=>[f(b(e.$t("common.button.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["disabled"])))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),m(A,{class:"uni-pagination-box"},{default:d((()=>[m(E,{"show-icon":"","show-page-size":"","page-size":i.size,modelValue:i.current,"onUpdate:modelValue":e=>i.current=e,total:i.count,onChange:T.onPageChanged,onPageSizeChange:T.pageSizeChange},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange","onPageSizeChange"])])),_:2},1024)])),_:1},8,["where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{F as default};
