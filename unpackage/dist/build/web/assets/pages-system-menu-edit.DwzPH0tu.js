import{_ as e,e as a,N as l,q as o,H as t,s as n,O as s,r as i,a as m,C as r,c as u,w as d,i as c,a5 as p,o as f,h as b,L as h,k as _,t as D,V,p as g,Z as x}from"./index-BQ2OFzYe.js";import{_ as k}from"./uni-easyinput.VVN8Z8n5.js";import{_ as y}from"./uni-forms-item.O5OP8sj5.js";import{_ as w}from"./uni-link.W0tBvBbx.js";import{_ as U}from"./uni-data-checkbox.C4wKLS-A.js";import{_ as I}from"./uni-forms.CeWDBJu8.js";import{v as j}from"./opendb-admin-menus.nWI8EMpJ.js";import v from"./pages-demo-icons-icons.CCDIpTDe.js";import"./uni-load-more.DvCLBvJD.js";const C=a.database();C.command;function L(e){let a={};for(let l in j)e.includes(l)&&(a[l]=j[l]);return a}const P=e({components:{Icons:v},data:()=>({formData:{menu_id:"",name:"",icon:"",url:"",sort:"",parent_id:"",permission:[],enable:null},rules:{...L(["menu_id","name","icon","url","sort","parent_id","permission","enable"])}}),onLoad(e){const a=e.id;this.formDataId=a,this.getDetail(a)},methods:{submitForm(e){this.$refs.form.submit()},submit(e){const{value:a,errors:i}=e.detail;i||(l({title:"修改中...",mask:!0}),C.collection("opendb-admin-menus").doc(this.formDataId).update(a).then((e=>{o({title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>t()),500)})).catch((e=>{n({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{s()})))},getDetail(e){l({mask:!0}),C.collection("opendb-admin-menus").where({_id:e}).get().then((e=>{const a=e.result.data[0];a&&(this.formData=a)})).catch((e=>{n({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{s()}))},showIconPopup(){this.$refs.iconPopup.open()}}},[["render",function(e,a,l,o,t,n){const s=i(m("uni-easyinput"),k),j=i(m("uni-forms-item"),y),v=i(m("uni-link"),w),C=i(m("uni-data-checkbox"),U),L=c,P=V,R=g,$=x,q=r("Icons"),z=i(m("uni-popup"),p),E=i(m("uni-forms"),I);return f(),u(L,{class:"uni-container"},{default:d((()=>[b(E,{labelWidth:"80",ref:"form",modelValue:t.formData,"onUpdate:modelValue":a[9]||(a[9]=e=>t.formData=e),rules:t.rules,validateTrigger:"bind",onSubmit:n.submit},{default:d((()=>[b(j,{name:"menu_id",label:"标识",required:""},{default:d((()=>[b(s,{modelValue:t.formData.menu_id,"onUpdate:modelValue":a[0]||(a[0]=e=>t.formData.menu_id=e),clearable:!1,placeholder:"请输入菜单项的ID，不可重复"},null,8,["modelValue"])])),_:1}),b(j,{name:"name",label:"显示名称",required:""},{default:d((()=>[b(s,{modelValue:t.formData.name,"onUpdate:modelValue":a[1]||(a[1]=e=>t.formData.name=e),clearable:!1,placeholder:"请输入菜单名称"},null,8,["modelValue"])])),_:1}),b(j,{name:"icon",label:"图标 class",style:{"margin-bottom":"40px"}},{default:d((()=>[b(s,{modelValue:t.formData.icon,"onUpdate:modelValue":a[3]||(a[3]=e=>t.formData.icon=e),clearable:!1,placeholder:"请输入菜单图标css样式类名"},{default:d((()=>[h("span",{slot:"right",style:{color:"#007aff",cursor:"pointer","padding-right":"10px"},onClick:a[2]||(a[2]=(...e)=>n.showIconPopup&&n.showIconPopup(...e))},"内置图标")])),_:1},8,["modelValue"]),b(v,{"font-size":"12",href:"https://uniapp.dcloud.net.cn/uniCloud/admin?id=icon-%e5%9b%be%e6%a0%87",text:"如何使用自定义图标？",class:"uni-form-item-tips"})])),_:1}),b(j,{name:"url",label:"页面URL"},{default:d((()=>[b(s,{modelValue:t.formData.url,"onUpdate:modelValue":a[4]||(a[4]=e=>t.formData.url=e),clearable:!1,placeholder:"URL必须是/开头，URL为空代表是目录而不是叶子节点"},null,8,["modelValue"])])),_:1}),b(j,{name:"sort",label:"序号"},{default:d((()=>[b(s,{modelValue:t.formData.sort,"onUpdate:modelValue":a[5]||(a[5]=e=>t.formData.sort=e),clearable:!1,placeholder:"请输入菜单序号（越大越靠后）"},null,8,["modelValue"])])),_:1}),b(j,{name:"parent_id",label:"父菜单标识"},{default:d((()=>[b(s,{modelValue:t.formData.parent_id,"onUpdate:modelValue":a[6]||(a[6]=e=>t.formData.parent_id=e),clearable:!1,placeholder:"请输入父级菜单标识, 一级菜单不需要填写"},null,8,["modelValue"])])),_:1}),b(j,{name:"permission",label:"权限列表",class:"flex-center-x"},{default:d((()=>[b(C,{multiple:!0,modelValue:t.formData.permission,"onUpdate:modelValue":a[7]||(a[7]=e=>t.formData.permission=e),collection:"uni-id-permissions","page-size":500,field:"permission_name as text, permission_id as value"},null,8,["modelValue"]),b(L,{class:"uni-form-item-tips"},{default:d((()=>[_(" 当用户拥有以上被选中的权限时，可以访问此菜单。建议仅对子菜单配置权限，父菜单会自动包含。如不选择权限，意味着仅超级管理员可访问本菜单 ")])),_:1})])),_:1}),b(j,{name:"enable",label:"是否启用"},{default:d((()=>[b(P,{onChange:a[8]||(a[8]=a=>e.binddata("enable",a.detail.value)),checked:t.formData.enable},null,8,["checked"])])),_:1}),b(L,{class:"uni-button-group"},{default:d((()=>[b(R,{type:"primary",class:"uni-button",onClick:n.submitForm,style:{width:"100px"}},{default:d((()=>[_(D(e.$t("common.button.submit")),1)])),_:1},8,["onClick"]),b($,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:d((()=>[b(R,{class:"uni-button",style:{width:"100px"}},{default:d((()=>[_(D(e.$t("common.button.back")),1)])),_:1})])),_:1})])),_:1}),b(z,{class:"icon-modal-box",ref:"iconPopup",type:"center"},{default:d((()=>[b(L,{class:"icon-modal icon-modal-pc"},{default:d((()=>[b(q,{tag:!1,"fix-window":!1})])),_:1})])),_:1},512)])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-44dcf2da"]]);export{P as default};
