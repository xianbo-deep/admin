import{_ as e,e as a,N as t,s as i,q as r,H as o,O as l,r as s,a as d,c as n,w as m,i as c,o as u,h as f,k as p,p as h}from"./index-BQ2OFzYe.js";import{_ as D}from"./uni-easyinput.VVN8Z8n5.js";import{_ as I}from"./uni-forms-item.O5OP8sj5.js";import{_ as g}from"./uni-forms.CeWDBJu8.js";const _=a.database();const b=e({data:()=>({id:"",formData:{metricId:"",metricname:"",agentId:"",description:""},rules:{metricId:{rules:[{required:!0,errorMessage:"请输入指标ID"},{pattern:"^[a-zA-Z0-9_-]+$",errorMessage:"指标ID只能包含字母、数字、下划线和连字符"}]},metricname:{rules:[{required:!0,errorMessage:"请输入指标名称"}]}}}),onLoad(e){e.id&&(this.id=e.id,this.getDetail())},methods:{async submitForm(){var e;try{if(!(await this.$refs.form.validate()))return;t({title:this.id?"修改中...":"新增中..."});const s={metricId:this.formData.metricId.trim(),metricname:this.formData.metricname.trim(),agentId:(null==(e=this.formData.agentId)?void 0:e.trim())||"",description:this.formData.description||""};if(this.id)await _.collection("Metric").doc(this.id).update(s),r({title:"修改成功"});else try{const e=await _.collection("Metric").where({metricId:s.metricId}).get();if(((null==e?void 0:e.data)||[]).length>0)return void i({content:"指标ID已存在",showCancel:!1});await _.collection("Metric").add(s),r({title:"新增成功"})}catch(a){return void i({content:a.message||"新增失败",showCancel:!1})}this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>o()),500)}catch(s){i({content:s.message||"操作失败",showCancel:!1})}finally{l()}},async getDetail(){try{t({mask:!0});const{data:e}=await _.collection("Metric").doc(this.id).field("metricId,metricname,agentId,description").get();e[0]&&(this.formData=e[0])}catch(e){i({content:e.message||"获取详情失败",showCancel:!1})}finally{l()}},goBack(){o()}}},[["render",function(e,a,t,i,r,o){const l=s(d("uni-easyinput"),D),_=s(d("uni-forms-item"),I),b=h,w=c,y=s(d("uni-forms"),g);return u(),n(w,{class:"container"},{default:m((()=>[f(y,{ref:"form",model:r.formData,rules:r.rules},{default:m((()=>[f(_,{label:"指标ID",name:"metricId",required:""},{default:m((()=>[f(l,{modelValue:r.formData.metricId,"onUpdate:modelValue":a[0]||(a[0]=e=>r.formData.metricId=e),placeholder:"请输入指标ID",disabled:!!r.id},null,8,["modelValue","disabled"])])),_:1}),f(_,{label:"指标名称",name:"metricname",required:""},{default:m((()=>[f(l,{modelValue:r.formData.metricname,"onUpdate:modelValue":a[1]||(a[1]=e=>r.formData.metricname=e),placeholder:"请输入指标名称"},null,8,["modelValue"])])),_:1}),f(_,{label:"代理ID",name:"agentId"},{default:m((()=>[f(l,{modelValue:r.formData.agentId,"onUpdate:modelValue":a[2]||(a[2]=e=>r.formData.agentId=e),placeholder:"请输入代理ID"},null,8,["modelValue"])])),_:1}),f(_,{label:"描述",name:"description"},{default:m((()=>[f(l,{type:"textarea",modelValue:r.formData.description,"onUpdate:modelValue":a[3]||(a[3]=e=>r.formData.description=e),placeholder:"请输入描述信息"},null,8,["modelValue"])])),_:1}),f(w,{class:"btn-group"},{default:m((()=>[f(b,{onClick:o.submitForm,type:"primary",class:"btn"},{default:m((()=>[p("提交")])),_:1},8,["onClick"]),f(b,{onClick:o.goBack,class:"btn"},{default:m((()=>[p("返回")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])),_:1})}],["__scopeId","data-v-15951e9b"]]);export{b as default};
