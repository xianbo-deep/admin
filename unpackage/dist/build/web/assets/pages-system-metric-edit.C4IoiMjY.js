import{_ as e,e as a,N as t,s as l,O as r,q as s,H as o,r as i,a as n,c as m,w as d,i as c,o as u,h as f,k as h,p,Z as D}from"./index-BQ2OFzYe.js";import{_ as I}from"./uni-easyinput.VVN8Z8n5.js";import{_ as g}from"./uni-forms-item.O5OP8sj5.js";import{_ as b}from"./uni-forms.CeWDBJu8.js";const _=a.database();const V=e({data:()=>({formDataId:"",formData:{metricId:"",agentId:"",metricname:"",description:""},rules:{metricId:{rules:[{required:!0,errorMessage:"请输入指标ID"},{pattern:"^[a-zA-Z0-9]+$",errorMessage:"指标ID只能包含字母和数字"}]},metricname:{rules:[{required:!0,errorMessage:"请输入指标名称"}]}}}),onLoad(e){e.id&&(this.formDataId=e.id,this.getDetail(e.id))},methods:{submitForm(){this.$refs.form.submit()},submit(e){const{value:a,errors:s}=e.detail;s||(t({title:this.formDataId?"修改中...":"新增中...",mask:!0}),this.formDataId?this.submitData(a):_.collection("Metric").where({metricId:a.metricId}).get().then((e=>{e.result.data.length>0?(l({content:"指标ID已存在",showCancel:!1}),r()):this.submitData(a)})).catch((e=>{r(),l({content:e.message||"请求服务失败",showCancel:!1})})))},submitData(e){e.agentId&&(e.agentId=e.agentId.trim()),this.formDataId?_.collection("Metric").doc(this.formDataId).update(e).then((()=>{s({title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>o()),500)})).catch((e=>{l({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{r()})):_.collection("Metric").add(e).then((()=>{s({title:"新增成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>o()),500)})).catch((e=>{l({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{r()}))},getDetail(e){t({mask:!0}),_.collection("Metric").doc(e).field("metricId,agentId,metricname,description").get().then((e=>{const a=e.result.data[0];a&&(this.formData=Object.assign({},this.formData,a))})).catch((e=>{l({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{r()}))}}},[["render",function(e,a,t,l,r,s){const o=i(n("uni-easyinput"),I),_=i(n("uni-forms-item"),g),V=p,y=D,w=c,C=i(n("uni-forms"),b);return u(),m(w,{class:"uni-container"},{default:d((()=>[f(C,{ref:"form",modelValue:r.formData,"onUpdate:modelValue":a[4]||(a[4]=e=>r.formData=e),rules:r.rules,validateTrigger:"bind",onSubmit:s.submit},{default:d((()=>[f(_,{name:"metricId",label:"指标ID",required:""},{default:d((()=>[f(o,{modelValue:r.formData.metricId,"onUpdate:modelValue":a[0]||(a[0]=e=>r.formData.metricId=e),clearable:!1,placeholder:"请输入指标ID",disabled:!!r.formDataId},null,8,["modelValue","disabled"])])),_:1}),f(_,{name:"agentId",label:"代理ID"},{default:d((()=>[f(o,{modelValue:r.formData.agentId,"onUpdate:modelValue":a[1]||(a[1]=e=>r.formData.agentId=e),clearable:!1,placeholder:"请输入代理ID"},null,8,["modelValue"])])),_:1}),f(_,{name:"metricname",label:"指标名称",required:""},{default:d((()=>[f(o,{modelValue:r.formData.metricname,"onUpdate:modelValue":a[2]||(a[2]=e=>r.formData.metricname=e),clearable:!1,placeholder:"请输入指标名称"},null,8,["modelValue"])])),_:1}),f(_,{name:"description",label:"描述"},{default:d((()=>[f(o,{type:"textarea",modelValue:r.formData.description,"onUpdate:modelValue":a[3]||(a[3]=e=>r.formData.description=e),placeholder:"请输入描述"},null,8,["modelValue"])])),_:1}),f(w,{class:"uni-button-group"},{default:d((()=>[f(V,{style:{width:"100px"},type:"primary",class:"uni-button",onClick:s.submitForm},{default:d((()=>[h("提交")])),_:1},8,["onClick"]),f(y,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:d((()=>[f(V,{style:{width:"100px"},class:"uni-button"},{default:d((()=>[h("返回")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-0e7d9c17"]]);export{V as default};
