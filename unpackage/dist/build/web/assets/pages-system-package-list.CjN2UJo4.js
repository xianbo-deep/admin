import{_ as e,e as a,s as t,q as n,n as i,r as s,a as r,c as l,w as o,i as d,b as c,d as u,f as g,g as p,o as h,h as m,k as f,l as _,m as y,F as b,I as C,p as k,t as z}from"./index-1tsbwzWw.js";import{_ as x}from"./uni-stat-breadcrumb.gfsZYonB.js";import{_ as $}from"./uni-tag.DJHF5HP_.js";import{_ as w}from"./uni-pagination.DVZKLAsf.js";import{_ as D}from"./unicloud-db.DwiPvpWe.js";const v=a.database(),S=v.command,T=["package_name"],q={ascending:"asc",descending:"desc"};const I=e({data:()=>({query:"",where:"",orderby:"package_id asc",orderByFieldName:"",options:{pageSize:20,pageCurrent:1,getone:!1,manual:!1},data:[]}),computed:{displayData(){return this.data}},mounted(){this.loadData()},methods:{getWhere(){const e=this.query.trim();if(!e)return"";const a=new RegExp(e,"i");return S.or(T.map((e=>({[e]:a}))))},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},changeSize(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb&&this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.$refs.udb.loadData({current:e.current})},sortChange(e,a){this.orderByFieldName=a,e.order?this.orderby=a+" "+q[e.order]:this.orderby="package_id asc",this.$nextTick((()=>{this.$refs.udb.loadData()}))},async onqueryload(e){const a=Array.isArray(e)?e:e.data;a&&0!==a.length?this.$set(this,"data",a):this.$set(this,"data",[])},async handleStatusChange(e){const a="active"===e.status?"inactive":"active",i="active"===a?"启用":"禁用";t({title:"提示",content:`确认${i}该套餐？`,success:async t=>{if(t.confirm)try{await v.collection("Package").doc(e._id).update({status:a}),this.loadData(!0),n({title:`${i}成功`,icon:"success"})}catch(s){console.error(`${i}失败:`,s),n({title:`${i}失败`,icon:"error"})}}})},navigateTo(e,a=!0){e&&i({url:e,events:{refreshData:()=>{this.loadData(a)}}})}}},[["render",function(e,a,t,n,i,v){const S=s(r("uni-stat-breadcrumb"),x),T=C,q=k,I=d,V=s(r("uni-th"),c),A=s(r("uni-tr"),u),P=s(r("uni-td"),g),j=s(r("uni-tag"),$),F=s(r("uni-table"),p),L=s(r("uni-pagination"),w),U=s(r("unicloud-db"),D);return h(),l(I,{class:"fix-top-window"},{default:o((()=>[m(I,{class:"uni-header"},{default:o((()=>[m(S,{class:"uni-stat-breadcrumb-on-phone"}),m(I,{class:"uni-group"},{default:o((()=>[m(T,{class:"uni-search",type:"text",modelValue:i.query,"onUpdate:modelValue":a[0]||(a[0]=e=>i.query=e),onConfirm:v.search,placeholder:"搜索套餐名称..."},null,8,["modelValue","onConfirm"]),m(q,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:v.search},{default:o((()=>[f("搜索")])),_:1},8,["onClick"]),m(q,{class:"uni-button",type:"primary",size:"mini",onClick:a[1]||(a[1]=e=>v.navigateTo("./add"))},{default:o((()=>[f("新增套餐")])),_:1})])),_:1})])),_:1}),m(I,{class:"uni-container"},{default:o((()=>[m(U,{ref:"udb",collection:"Package",field:"package_id,package_name,AgentId,status,metrics",where:i.where,"page-data":"replace",getcount:!0,"page-size":i.options.pageSize,"page-current":i.options.pageCurrent,orderby:i.orderby,loadtime:"manual",onLoad:v.onqueryload},{default:o((({pagination:e,loading:t,error:n})=>[m(F,{ref:"table",loading:t,emptyText:n.message||"没有数据",border:"",stripe:""},{default:o((()=>[m(A,null,{default:o((()=>[m(V,{align:"center",sortable:"",onSortChange:a[2]||(a[2]=e=>v.sortChange(e,"package_id"))},{default:o((()=>[f("套餐ID")])),_:1}),m(V,{align:"center"},{default:o((()=>[f("套餐名称")])),_:1}),m(V,{align:"center"},{default:o((()=>[f("Agent ID")])),_:1}),m(V,{align:"center"},{default:o((()=>[f("包含指标")])),_:1}),m(V,{align:"center",sortable:"",onSortChange:a[3]||(a[3]=e=>v.sortChange(e,"status"))},{default:o((()=>[f("状态")])),_:1}),m(V,{align:"center"},{default:o((()=>[f("操作")])),_:1})])),_:1}),(h(!0),_(b,null,y(v.displayData,(e=>(h(),l(A,{key:e._id},{default:o((()=>[m(P,{align:"center"},{default:o((()=>[f(z(e.package_id),1)])),_:2},1024),m(P,{align:"center"},{default:o((()=>[m(I,{class:"ellipsis",title:e.package_name},{default:o((()=>[f(z(e.package_name),1)])),_:2},1032,["title"])])),_:2},1024),m(P,{align:"center"},{default:o((()=>[m(I,{class:"ellipsis",title:e.AgentId},{default:o((()=>[f(z(e.AgentId),1)])),_:2},1032,["title"])])),_:2},1024),m(P,{align:"center"},{default:o((()=>[m(I,{class:"metrics-list"},{default:o((()=>[(h(!0),_(b,null,y(e.metrics,(e=>(h(),l(j,{key:e.metric_id,text:e.metric_name,type:"primary",size:"small"},null,8,["text"])))),128))])),_:2},1024)])),_:2},1024),m(P,{align:"center"},{default:o((()=>[m(j,{text:"active"===e.status?"启用":"禁用",type:"active"===e.status?"success":"warning"},null,8,["text","type"])])),_:2},1024),m(P,{align:"center"},{default:o((()=>[m(I,{class:"uni-group"},{default:o((()=>[m(q,{onClick:a=>v.handleStatusChange(e),class:"uni-button",size:"mini",type:"active"===e.status?"warning":"primary"},{default:o((()=>[f(z("active"===e.status?"禁用":"启用"),1)])),_:2},1032,["onClick","type"]),m(q,{onClick:a=>v.navigateTo(`./edit?id=${e._id}`),class:"uni-button",size:"mini",type:"primary"},{default:o((()=>[f("编辑")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText"]),m(I,{class:"uni-pagination-box"},{default:o((()=>[m(L,{"show-icon":"","show-page-size":"","page-size":e.size,modelValue:e.current,"onUpdate:modelValue":a=>e.current=a,total:e.count,onChange:v.onPageChanged,onPageSizeChange:v.changeSize},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange","onPageSizeChange"])])),_:2},1024)])),_:1},8,["where","page-size","page-current","orderby","onLoad"])])),_:1})])),_:1})}],["__scopeId","data-v-a12f8083"]]);export{I as default};
