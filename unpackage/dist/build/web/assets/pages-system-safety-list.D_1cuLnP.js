import{_ as e,e as a,q as t,n,r,a as i,c as s,w as l,i as o,b as d,d as u,f as c,g as p,o as m,h as g,k as h,t as f,l as _,m as b,F as y,I as C,p as x}from"./index-BQ2OFzYe.js";import{_ as w}from"./uni-stat-breadcrumb.DHkfubMW.js";import{_ as z}from"./uni-dateformat.C3vwkADr.js";import{_ as k}from"./uni-pagination.Bz9-uLqg.js";import{_ as D}from"./unicloud-db.C6t2K4BA.js";const V=a.database(),$=["user_id.username","user_id.nickname","type","ip"];const j=e({data:()=>({collectionList:[V.collection("uni-id-log").field("type, ip, create_date, user_id").getTemp(),V.collection("uni-id-users").field("_id, username,nickname").getTemp()],query:"",where:"",orderby:"create_date desc",options:{pageSize:20,pageCurrent:1}}),methods:{getWhere(){const e=this.query.trim();if(!e)return"";let a;try{a=new RegExp(e,"i")}catch(n){return void t({title:"请勿输入等不满足正则格式的符号",icon:"none"})}return $.map((e=>a+".test("+e+")")).join(" || ")},search(){const e=this.getWhere(),a=e===this.where;this.where=e,a&&this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.$refs.udb.loadData({current:e.current})},navigateTo(e){n({url:e,events:{refreshData:()=>{this.loadData()}}})},selectedItems(){let e=this.$refs.udb.dataList;return this.selectedIndexs.map((a=>e[a]._id))},delTable(){this.$refs.udb.remove(this.selectedItems())},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e)}}},[["render",function(e,a,t,n,V,$){const j=r(i("uni-stat-breadcrumb"),w),q=C,I=x,T=o,v=r(i("uni-th"),d),L=r(i("uni-tr"),u),P=r(i("uni-td"),c),U=r(i("uni-dateformat"),z),F=r(i("uni-table"),p),S=r(i("uni-pagination"),k),W=r(i("unicloud-db"),D);return m(),s(T,null,{default:l((()=>[g(T,{class:"uni-header"},{default:l((()=>[g(j,{class:"uni-stat-breadcrumb-on-phone"}),g(T,{class:"uni-group"},{default:l((()=>[g(q,{class:"uni-search",type:"text",modelValue:V.query,"onUpdate:modelValue":a[0]||(a[0]=e=>V.query=e),onConfirm:$.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),g(I,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:$.search},{default:l((()=>[h(f(e.$t("common.button.search")),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),g(T,{class:"uni-container"},{default:l((()=>[g(W,{ref:"udb",collection:V.collectionList,options:V.options,where:V.where,"page-data":"replace",orderby:V.orderby,getcount:!0,"page-size":V.options.pageSize,"page-current":V.options.pageCurrent},{default:l((({data:e,pagination:a,loading:t,error:n})=>[g(F,{loading:t,emptyText:n.message||"没有更多数据",border:"",stripe:""},{default:l((()=>[g(L,null,{default:l((()=>[g(v,{align:"center"},{default:l((()=>[h("序号")])),_:1}),g(v,{align:"center"},{default:l((()=>[h("用户名")])),_:1}),g(v,{align:"center"},{default:l((()=>[h("昵称")])),_:1}),g(v,{align:"center"},{default:l((()=>[h("内容")])),_:1}),g(v,{align:"center"},{default:l((()=>[h("IP")])),_:1}),g(v,{align:"center"},{default:l((()=>[h("时间")])),_:1})])),_:1}),(m(!0),_(y,null,b(e,((e,t)=>(m(),s(L,{key:t},{default:l((()=>[g(P,{align:"center"},{default:l((()=>[h(f((a.current-1)*a.size+(t+1)),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[h(f(e.user_id[0]&&e.user_id[0].username||"-"),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[h(f(e.user_id[0]&&e.user_id[0].nickname||"-"),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[h(f(e.type),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[h(f(e.ip),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[g(U,{date:e.create_date,threshold:[0,0]},null,8,["date"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText"]),g(T,{class:"uni-pagination-box"},{default:l((()=>[g(S,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:$.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","options","where","orderby","page-size","page-current"])])),_:1})])),_:1})}]]);export{j as default};
