import{_ as e,e as a,N as t,q as r,H as m,s as l,O as o,r as n,a as i,c as s,w as u,i as d,aD as f,o as p,h as c,j as D,l as b,F as h,k as g,u as y,V,p as T}from"./index-1tsbwzWw.js";import{_ as v}from"./uni-easyinput.B-y-wvYA.js";import{_}from"./uni-forms-item.C04_D_PQ.js";import{_ as U}from"./uni-data-select.ZmgLG0mc.js";import{_ as x}from"./uni-forms.Cx-ojO0j.js";const k=a.database();const w=e({data(){return{formData:{userId:"",nickname:"",password:"",avatarUrl:"",email:"",phone:"",status:"active",bio:"",registerTime:0,lastLoginTime:0,memberStatus:"none",membertype:"none",remainingDays:0,remainingTimes:0,usedTrial:!1,memberStartTime:0,memberExpireTime:0},rules:{userId:{rules:[{required:!0,errorMessage:"用户ID不能为空"},{validateFunction:this.validateUserId}]},nickname:{rules:[{required:!0,errorMessage:"用户昵称不能为空"}]},password:{rules:[{required:!0,errorMessage:"登录密码不能为空"},{minLength:6,errorMessage:"密码长度不能小于6位"}]},avatarUrl:{rules:[{required:!0,errorMessage:"头像URL不能为空"}]},email:{rules:[{required:!0,errorMessage:"电子邮件不能为空"},{format:"email",errorMessage:"电子邮件格式不正确"}]},phone:{rules:[{required:!0,errorMessage:"手机号码不能为空"},{pattern:/^1\d{10}$/,errorMessage:"手机号码格式不正确"}]},remainingDays:{rules:[{validateFunction:(e,a,t,r)=>{"daily"!==t.membertype&&"monthly"!==t.membertype||a&&!(a<0)?r():r("剩余天数必须大于或等于0")}}]},remainingTimes:{rules:[{validateFunction:(e,a,t,r)=>{"times"===t.membertype&&(!a||a<0)?r("剩余次数必须大于或等于0"):r()}}]},memberExpireTime:{rules:[{validateFunction:(e,a,t,r)=>{"none"===t.membertype||"active"!==t.memberStatus||a?r():r("会员到期时间不能为空")}}]}},statusOptions:[{value:"active",text:"正常"},{value:"inactive",text:"未激活"},{value:"banned",text:"已禁用"}],memberTypeOptions:[{value:"none",text:"非会员"},{value:"daily",text:"日卡"},{value:"monthly",text:"月卡"},{value:"times",text:"次卡"}],memberStatusOptions:[{value:"none",text:"非会员"},{value:"active",text:"有效"},{value:"expired",text:"已过期"}]}},methods:{onMemberTypeChange(e){const a=e;if("none"===a)this.formData.memberStatus="none",this.formData.remainingDays=0,this.formData.remainingTimes=0,this.formData.memberExpireTime=0,this.formData.memberStartTime=0,this.formData.usedTrial=!1;else if(this.formData.memberStatus="active",this.formData.memberStartTime=Date.now(),"times"===a){this.formData.remainingDays=0,this.formData.remainingTimes=10;const e=new Date;e.setMonth(e.getMonth()+1),this.formData.memberExpireTime=e.getTime()}else if(this.formData.remainingTimes=0,"daily"===a){this.formData.remainingDays=30;const e=new Date;e.setDate(e.getDate()+30),this.formData.memberExpireTime=e.getTime()}else if("monthly"===a){this.formData.remainingDays=30;const e=new Date;e.setMonth(e.getMonth()+1),this.formData.memberExpireTime=e.getTime()}},onAvatarError(){this.formData.avatarUrl="/static/avatar.png"},validateUserId(e,a,t,r){/^[a-zA-Z0-9_-]{4,20}$/.test(a)?k.collection("User").where(`userId == "${a}"`).count().then((e=>{e.result.total>0?r("该用户ID已存在"):r()})).catch((e=>{r("验证用户ID时出错")})):r("用户ID只能包含字母、数字、下划线和横杠，长度4-20位")},generateToken:()=>Math.random().toString(36).substring(2)+Date.now().toString(36),submitForm(){this.$refs.form.validate().then((e=>{t({title:"保存中...",mask:!0});const a={...this.formData,registerTime:Date.now(),lastLoginTime:Date.now(),token:this.generateToken(),remainingDays:Number(this.formData.remainingDays||0),remainingTimes:Number(this.formData.remainingTimes||0)};k.collection("User").add(a).then((()=>{r({title:"创建成功"});this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>m()),500)})).catch((e=>{l({content:e.message||"创建失败",showCancel:!1})})).finally((()=>{o()}))})).catch((e=>{console.error("表单验证错误:",e)}))},goBack(){m()}}},[["render",function(e,a,t,r,m,l){const o=n(i("uni-easyinput"),v),k=n(i("uni-forms-item"),_),w=y,M=d,S=n(i("uni-data-select"),U),I=n(i("uni-datetime-picker"),f),q=V,E=T,C=n(i("uni-forms"),x);return p(),s(M,{class:"uni-container"},{default:u((()=>[c(C,{ref:"form",modelValue:m.formData,"onUpdate:modelValue":a[14]||(a[14]=e=>m.formData=e),rules:m.rules,validateTrigger:"bind",onSubmit:e.submit},{default:u((()=>[c(k,{name:"userId",label:"用户ID",required:""},{default:u((()=>[c(o,{modelValue:m.formData.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>m.formData.userId=e),placeholder:"请输入用户ID"},null,8,["modelValue"])])),_:1}),c(k,{name:"nickname",label:"用户昵称",required:""},{default:u((()=>[c(o,{modelValue:m.formData.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>m.formData.nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])])),_:1}),c(k,{name:"password",label:"登录密码",required:""},{default:u((()=>[c(o,{modelValue:m.formData.password,"onUpdate:modelValue":a[2]||(a[2]=e=>m.formData.password=e),type:"password",placeholder:"请输入登录密码"},null,8,["modelValue"])])),_:1}),c(k,{name:"avatarUrl",label:"头像URL",required:""},{default:u((()=>[c(M,{class:"avatar-container"},{default:u((()=>[c(w,{class:"avatar-preview",src:m.formData.avatarUrl||"/static/avatar.png",mode:"aspectFill",onError:l.onAvatarError},null,8,["src","onError"]),c(o,{modelValue:m.formData.avatarUrl,"onUpdate:modelValue":a[3]||(a[3]=e=>m.formData.avatarUrl=e),placeholder:"请输入头像URL"},null,8,["modelValue"])])),_:1})])),_:1}),c(k,{name:"phone",label:"手机号码",required:""},{default:u((()=>[c(o,{modelValue:m.formData.phone,"onUpdate:modelValue":a[4]||(a[4]=e=>m.formData.phone=e),placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),c(k,{name:"email",label:"电子邮件",required:""},{default:u((()=>[c(o,{modelValue:m.formData.email,"onUpdate:modelValue":a[5]||(a[5]=e=>m.formData.email=e),placeholder:"请输入电子邮件"},null,8,["modelValue"])])),_:1}),c(k,{name:"status",label:"账户状态",required:""},{default:u((()=>[c(S,{modelValue:m.formData.status,"onUpdate:modelValue":a[6]||(a[6]=e=>m.formData.status=e),localdata:m.statusOptions,clear:!1},null,8,["modelValue","localdata"])])),_:1}),c(k,{name:"membertype",label:"会员卡类型"},{default:u((()=>[c(S,{modelValue:m.formData.membertype,"onUpdate:modelValue":a[7]||(a[7]=e=>m.formData.membertype=e),localdata:m.memberTypeOptions,clear:!1,onChange:l.onMemberTypeChange},null,8,["modelValue","localdata","onChange"])])),_:1}),c(k,{name:"memberStatus",label:"会员状态"},{default:u((()=>[c(S,{modelValue:m.formData.memberStatus,"onUpdate:modelValue":a[8]||(a[8]=e=>m.formData.memberStatus=e),localdata:m.memberStatusOptions,clear:!1},null,8,["modelValue","localdata"])])),_:1}),"daily"===m.formData.membertype||"monthly"===m.formData.membertype?(p(),s(k,{key:0,name:"remainingDays",label:"剩余天数"},{default:u((()=>[c(o,{modelValue:m.formData.remainingDays,"onUpdate:modelValue":a[9]||(a[9]=e=>m.formData.remainingDays=e),type:"number",placeholder:"请输入剩余天数"},null,8,["modelValue"])])),_:1})):D("",!0),"times"===m.formData.membertype?(p(),s(k,{key:1,name:"remainingTimes",label:"剩余次数"},{default:u((()=>[c(o,{modelValue:m.formData.remainingTimes,"onUpdate:modelValue":a[10]||(a[10]=e=>m.formData.remainingTimes=e),type:"number",placeholder:"请输入剩余次数"},null,8,["modelValue"])])),_:1})):D("",!0),"none"!==m.formData.membertype?(p(),b(h,{key:2},[c(k,{name:"memberExpireTime",label:"会员到期时间"},{default:u((()=>[c(I,{modelValue:m.formData.memberExpireTime,"onUpdate:modelValue":a[11]||(a[11]=e=>m.formData.memberExpireTime=e),type:"datetime","return-type":"timestamp"},null,8,["modelValue"])])),_:1}),c(k,{name:"usedTrial",label:"是否体验卡"},{default:u((()=>[c(q,{checked:m.formData.usedTrial,onChange:a[12]||(a[12]=e=>m.formData.usedTrial=e.detail.value)},null,8,["checked"])])),_:1})],64)):D("",!0),c(k,{name:"bio",label:"用户简介"},{default:u((()=>[c(o,{modelValue:m.formData.bio,"onUpdate:modelValue":a[13]||(a[13]=e=>m.formData.bio=e),type:"textarea",placeholder:"请输入用户简介"},null,8,["modelValue"])])),_:1}),c(M,{class:"uni-button-group"},{default:u((()=>[c(E,{type:"primary",class:"uni-button",onClick:l.submitForm},{default:u((()=>[g("提交")])),_:1},8,["onClick"]),c(E,{class:"uni-button",onClick:l.goBack},{default:u((()=>[g("返回")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-44dda3aa"]]);export{w as default};
