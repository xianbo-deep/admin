import{_ as e,e as a,N as r,q as t,H as l,s as o,O as s,r as n,a as u,c as d,w as i,i as m,o as c,h as f,k as p,u as h,p as D}from"./index-BQ2OFzYe.js";import{_ as g}from"./uni-easyinput.VVN8Z8n5.js";import{_ as v}from"./uni-forms-item.O5OP8sj5.js";import{_ as V}from"./uni-data-select.B2KmuFFT.js";import{_ as b}from"./uni-forms.CeWDBJu8.js";const U=a.database();const _=e({data(){return{formData:{userId:"",nickname:"",password:"",avatarUrl:"",email:"",phone:"",status:"active",bio:"",registerTime:0,lastLoginTime:0},rules:{userId:{rules:[{required:!0,errorMessage:"用户ID不能为空"},{validateFunction:this.validateUserId}]},nickname:{rules:[{required:!0,errorMessage:"用户昵称不能为空"}]},password:{rules:[{required:!0,errorMessage:"登录密码不能为空"},{minLength:6,errorMessage:"密码长度不能小于6位"}]},avatarUrl:{rules:[{required:!0,errorMessage:"头像URL不能为空"}]},email:{rules:[{required:!0,errorMessage:"电子邮件不能为空"},{format:"email",errorMessage:"电子邮件格式不正确"}]},phone:{rules:[{required:!0,errorMessage:"手机号码不能为空"},{pattern:/^1\d{10}$/,errorMessage:"手机号码格式不正确"}]}},statusOptions:[{value:"active",text:"正常"},{value:"inactive",text:"未激活"},{value:"banned",text:"已禁用"}]}},methods:{onAvatarError(){this.formData.avatarUrl="/static/avatar.png"},validateUserId(e,a,r,t){/^[a-zA-Z0-9_-]{4,20}$/.test(a)?U.collection("User").where(`userId == "${a}"`).count().then((e=>{e.result.total>0?t("该用户ID已存在"):t()})).catch((e=>{t("验证用户ID时出错")})):t("用户ID只能包含字母、数字、下划线和横杠，长度4-20位")},generateToken:()=>Math.random().toString(36).substring(2)+Date.now().toString(36),submitForm(){this.$refs.form.validate().then((e=>{r({title:"保存中...",mask:!0});const a={...this.formData,registerTime:Date.now(),lastLoginTime:Date.now(),token:this.generateToken()};U.collection("User").add(a).then((()=>{t({title:"创建成功"});this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>l()),500)})).catch((e=>{o({content:e.message||"创建失败",showCancel:!1})})).finally((()=>{s()}))})).catch((e=>{console.error("表单验证错误:",e)}))},goBack(){l()}}},[["render",function(e,a,r,t,l,o){const s=n(u("uni-easyinput"),g),U=n(u("uni-forms-item"),v),_=h,k=m,I=n(u("uni-data-select"),V),q=D,w=n(u("uni-forms"),b);return c(),d(k,{class:"uni-container"},{default:i((()=>[f(w,{ref:"form",modelValue:l.formData,"onUpdate:modelValue":a[8]||(a[8]=e=>l.formData=e),rules:l.rules,validateTrigger:"bind",onSubmit:e.submit},{default:i((()=>[f(U,{name:"userId",label:"用户ID",required:""},{default:i((()=>[f(s,{modelValue:l.formData.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>l.formData.userId=e),placeholder:"请输入用户ID"},null,8,["modelValue"])])),_:1}),f(U,{name:"nickname",label:"用户昵称",required:""},{default:i((()=>[f(s,{modelValue:l.formData.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>l.formData.nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])])),_:1}),f(U,{name:"password",label:"登录密码",required:""},{default:i((()=>[f(s,{modelValue:l.formData.password,"onUpdate:modelValue":a[2]||(a[2]=e=>l.formData.password=e),type:"password",placeholder:"请输入登录密码"},null,8,["modelValue"])])),_:1}),f(U,{name:"avatarUrl",label:"头像URL",required:""},{default:i((()=>[f(k,{class:"avatar-container"},{default:i((()=>[f(_,{class:"avatar-preview",src:l.formData.avatarUrl||"/static/avatar.png",mode:"aspectFill",onError:o.onAvatarError},null,8,["src","onError"]),f(s,{modelValue:l.formData.avatarUrl,"onUpdate:modelValue":a[3]||(a[3]=e=>l.formData.avatarUrl=e),placeholder:"请输入头像URL"},null,8,["modelValue"])])),_:1})])),_:1}),f(U,{name:"phone",label:"手机号码",required:""},{default:i((()=>[f(s,{modelValue:l.formData.phone,"onUpdate:modelValue":a[4]||(a[4]=e=>l.formData.phone=e),placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),f(U,{name:"email",label:"电子邮件",required:""},{default:i((()=>[f(s,{modelValue:l.formData.email,"onUpdate:modelValue":a[5]||(a[5]=e=>l.formData.email=e),placeholder:"请输入电子邮件"},null,8,["modelValue"])])),_:1}),f(U,{name:"status",label:"账户状态",required:""},{default:i((()=>[f(I,{modelValue:l.formData.status,"onUpdate:modelValue":a[6]||(a[6]=e=>l.formData.status=e),localdata:l.statusOptions,clear:!1},null,8,["modelValue","localdata"])])),_:1}),f(U,{name:"bio",label:"用户简介"},{default:i((()=>[f(s,{modelValue:l.formData.bio,"onUpdate:modelValue":a[7]||(a[7]=e=>l.formData.bio=e),type:"textarea",placeholder:"请输入用户简介"},null,8,["modelValue"])])),_:1}),f(k,{class:"uni-button-group"},{default:i((()=>[f(q,{type:"primary",class:"uni-button",onClick:o.submitForm},{default:i((()=>[p("提交")])),_:1},8,["onClick"]),f(q,{class:"uni-button",onClick:o.goBack},{default:i((()=>[p("返回")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-b684dd05"]]);export{_ as default};
