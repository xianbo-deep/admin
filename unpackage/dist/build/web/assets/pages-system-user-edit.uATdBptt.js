import{_ as e,e as a,N as t,s as r,H as o,O as l,q as s,r as i,a as d,c as m,w as n,i as u,o as f,h as c,k as h,L as p,u as g,p as D,Z as b}from"./index-BQ2OFzYe.js";import{_ as w}from"./uni-easyinput.VVN8Z8n5.js";import{_ as V}from"./uni-forms-item.O5OP8sj5.js";import{_ as v}from"./uni-data-select.B2KmuFFT.js";import{_}from"./uni-forms.CeWDBJu8.js";const U=a.database();const k=e({data:()=>({formDataId:"",showPassword:!1,formData:{userId:"",nickname:"",avatarUrl:"",password:void 0,phone:"",email:"",status:"active",bio:"",registerTime:0,lastLoginTime:0,token:""},rules:{userId:{rules:[{required:!0,errorMessage:"用户ID不能为空"}]},nickname:{rules:[{required:!0,errorMessage:"用户昵称不能为空"}]},avatarUrl:{rules:[{required:!0,errorMessage:"头像URL不能为空"}]},email:{rules:[{required:!0,errorMessage:"电子邮件不能为空"},{format:"email",errorMessage:"电子邮件格式不正确"}]},phone:{rules:[{required:!0,errorMessage:"手机号码不能为空"},{pattern:/^1\d{10}$/,errorMessage:"手机号码格式不正确"}]},password:{rules:[{minLength:6,errorMessage:"密码长度不能小于6位"}]}},statusOptions:[{value:"active",text:"正常"},{value:"inactive",text:"未激活"},{value:"banned",text:"已禁用"}]}),computed:{formattedRegisterTime(){return this.formatDateTime(this.formData.registerTime)},formattedLastLoginTime(){return this.formatDateTime(this.formData.lastLoginTime)}},onLoad(e){if(e.id)this.formDataId=e.id,this.getDetail(e.id);else{this.getOpenerEventChannel().on("editData",(e=>{e&&(this.formData={...this.formData,...e,password:void 0},this.formDataId=e.userId)}))}},methods:{onAvatarError(){this.formData.avatarUrl="/static/avatar.png"},trigger(){this.showPassword=!this.showPassword,this.showPassword||(this.formData.password=void 0)},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")}catch(a){return console.error("时间格式化错误:",a),""}},getDetail(e){t({mask:!0}),console.log("查询ID:",e),U.collection("User").where(`userId == "${e}"`).get().then((e=>{console.log("查询结果:",e);const a=e.result.data[0];a?this.formData=Object.assign({},this.formData,a):r({content:"未找到用户数据",showCancel:!1,success:()=>{o()}})})).catch((e=>{r({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{l()}))},submitForm(){this.$refs.form.validate().then((e=>{t({title:"保存中...",mask:!0});const a={userId:this.formData.userId,nickname:this.formData.nickname,avatarUrl:this.formData.avatarUrl,email:this.formData.email,phone:this.formData.phone,status:this.formData.status,bio:this.formData.bio||""};this.showPassword&&this.formData.password&&(a.password=this.formData.password),Object.keys(a).forEach((e=>{void 0===a[e]&&delete a[e]})),a._id&&delete a._id,console.log("更新数据:",a),U.collection("User").where(`userId == "${this.formData.userId}"`).update(a).then((()=>{s({title:"保存成功"});this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>o()),500)})).catch((e=>{r({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{l()}))})).catch((e=>{console.error("表单验证错误:",e)}))}}},[["render",function(e,a,t,r,o,l){const s=i(d("uni-easyinput"),w),U=i(d("uni-forms-item"),V),k=g,y=u,I=i(d("uni-data-select"),v),T=D,L=b,q=i(d("uni-forms"),_);return f(),m(y,{class:"uni-container"},{default:n((()=>[c(q,{ref:"form",modelValue:o.formData,"onUpdate:modelValue":a[11]||(a[11]=e=>o.formData=e),rules:o.rules,validateTrigger:"bind",onSubmit:e.submit},{default:n((()=>[c(U,{name:"userId",label:"用户ID",required:""},{default:n((()=>[c(s,{modelValue:o.formData.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.userId=e),clearable:!1,disabled:""},null,8,["modelValue"])])),_:1}),c(U,{name:"nickname",label:"用户昵称",required:""},{default:n((()=>[c(s,{modelValue:o.formData.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.nickname=e),clearable:!1,placeholder:"请输入用户昵称"},null,8,["modelValue"])])),_:1}),c(U,{name:"avatarUrl",label:"头像URL",required:""},{default:n((()=>[c(y,{class:"avatar-container"},{default:n((()=>[c(k,{class:"avatar-preview",src:o.formData.avatarUrl||"/static/avatar.png",mode:"aspectFill",onError:l.onAvatarError},null,8,["src","onError"]),c(s,{modelValue:o.formData.avatarUrl,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.avatarUrl=e),clearable:!1,placeholder:"请输入头像URL"},null,8,["modelValue"])])),_:1})])),_:1}),o.showPassword?(f(),m(U,{name:"password",label:"重置密码",key:"password"},{default:n((()=>[c(s,{modelValue:o.formData.password,"onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.password=e),type:"password",clearable:!1,placeholder:"请输入新密码"},{default:n((()=>[c(y,{slot:"right",class:"cancel-reset-password-btn",onClick:l.trigger},{default:n((()=>[h("取消")])),_:1},8,["onClick"])])),_:1},8,["modelValue"])])),_:1})):(f(),m(U,{key:1,label:"重置密码"},{default:n((()=>[p("span",{class:"reset-password-btn",onClick:a[4]||(a[4]=(...e)=>l.trigger&&l.trigger(...e))},"点击重置密码")])),_:1})),c(U,{name:"phone",label:"手机号码",required:""},{default:n((()=>[c(s,{modelValue:o.formData.phone,"onUpdate:modelValue":a[5]||(a[5]=e=>o.formData.phone=e),clearable:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),c(U,{name:"email",label:"电子邮件",required:""},{default:n((()=>[c(s,{modelValue:o.formData.email,"onUpdate:modelValue":a[6]||(a[6]=e=>o.formData.email=e),clearable:!1,placeholder:"请输入电子邮件"},null,8,["modelValue"])])),_:1}),c(U,{name:"status",label:"账户状态",required:""},{default:n((()=>[c(I,{modelValue:o.formData.status,"onUpdate:modelValue":a[7]||(a[7]=e=>o.formData.status=e),localdata:o.statusOptions,clear:!1},null,8,["modelValue","localdata"])])),_:1}),c(U,{name:"bio",label:"用户简介"},{default:n((()=>[c(s,{modelValue:o.formData.bio,"onUpdate:modelValue":a[8]||(a[8]=e=>o.formData.bio=e),type:"textarea",clearable:!1,placeholder:"请输入用户简介"},null,8,["modelValue"])])),_:1}),c(U,{name:"registerTime",label:"注册时间"},{default:n((()=>[c(s,{modelValue:l.formattedRegisterTime,"onUpdate:modelValue":a[9]||(a[9]=e=>l.formattedRegisterTime=e),disabled:""},null,8,["modelValue"])])),_:1}),c(U,{name:"lastLoginTime",label:"最后登录"},{default:n((()=>[c(s,{modelValue:l.formattedLastLoginTime,"onUpdate:modelValue":a[10]||(a[10]=e=>l.formattedLastLoginTime=e),disabled:""},null,8,["modelValue"])])),_:1}),c(y,{class:"uni-button-group"},{default:n((()=>[c(T,{style:{width:"100px"},type:"primary",class:"uni-button",onClick:l.submitForm},{default:n((()=>[h("提交")])),_:1},8,["onClick"]),c(L,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:n((()=>[c(T,{style:{width:"100px"},class:"uni-button"},{default:n((()=>[h("返回")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-705f8f4e"]]);export{k as default};
