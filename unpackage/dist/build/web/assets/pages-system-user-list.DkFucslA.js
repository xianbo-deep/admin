import{_ as e,e as t,q as a,n,s as i,r,a as l,c as s,w as o,i as c,b as u,d,f as m,g,o as h,h as p,k as f,l as b,m as y,F as T,I as _,p as x,t as C,u as v}from"./index-1tsbwzWw.js";import{_ as S}from"./uni-stat-breadcrumb.gfsZYonB.js";import{_ as k}from"./uni-tag.DJHF5HP_.js";import{_ as w}from"./uni-link.BfTFnGpL.js";import{_ as D}from"./uni-pagination.DVZKLAsf.js";import{_ as z}from"./unicloud-db.DwiPvpWe.js";const $=t.database(),I=["userId","nickname","phone","email","bio"],E={ascending:"asc",descending:"desc"};const L=e({data:()=>({collection:"User",query:"",where:"",orderby:"lastLoginTime desc",selectedIndexs:[],options:{pageSize:20,pageCurrent:1},statusOptions:[{text:"正常",value:"active"},{text:"未激活",value:"inactive"},{text:"已禁用",value:"banned"}],memberTypeOptions:[{text:"非会员",value:"none"},{text:"日卡",value:"daily"},{text:"月卡",value:"monthly"},{text:"次卡",value:"times"}],memberStatusOptions:[{text:"非会员",value:"none"},{text:"有效",value:"active"},{text:"已过期",value:"expired"}]}),onReady(){this.$refs.udb.loadData()},methods:{onAvatarError(e){e.avatarUrl="/static/avatar.png"},downloadAvatar(e,t){if(!e||"/static/avatar.png"===e)return void a({title:"无头像可下载",icon:"none"});const n=document.createElement("a");n.href=e,n.download=`${t||"avatar"}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),a({title:"开始下载",icon:"success"})},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")}catch(t){return console.error("时间格式化错误:",t),""}},getStatusType:e=>({active:"success",inactive:"warning",banned:"error"}[e]||"default"),getStatusText:e=>({active:"正常",inactive:"未激活",banned:"已禁用"}[e]||e),getMemberTypeTag:e=>({none:"default",daily:"primary",monthly:"success",times:"warning"}[e]||"default"),getMemberTypeText:e=>({none:"非会员",daily:"日卡",monthly:"月卡",times:"次卡"}[e]||e),getMemberStatusTag:e=>({none:"default",active:"success",expired:"error"}[e]||"default"),getMemberStatusText:e=>({none:"非会员",active:"有效",expired:"已过期"}[e]||e),onqueryload(e){e&&e.forEach((e=>{e.bio=e.bio||"",e.membertype=e.membertype||"none",e.memberStatus=e.memberStatus||"none",e.remainingDays=e.remainingDays||0,e.remainingTimes=e.remainingTimes||0,e.registerTime=e.registerTime||0,e.lastLoginTime=e.lastLoginTime||0,e.memberStartTime=e.memberStartTime||0,e.memberExpireTime=e.memberExpireTime||0}))},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return $.command.or(I.map((e=>({[e]:t}))))},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},changeSize(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t=!0){n({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){const e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t].userId))},delTable(){i({title:"确认删除",content:"是否删除选中的用户？",success:e=>{e.confirm&&this.$refs.udb.remove(this.selectedItems(),{success:()=>{this.$refs.table.clearSelection(),a({title:"删除成功",icon:"success"})},fail:e=>{a({title:"删除失败",icon:"error"}),console.error(e)}})}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){i({title:"确认删除",content:"是否删除该用户？",success:t=>{t.confirm&&this.$refs.udb.remove(e,{success:()=>{this.$refs.table.clearSelection(),a({title:"删除成功",icon:"success"})},fail:e=>{a({title:"删除失败",icon:"error"}),console.error(e)}})}})},sortChange(e,t){e.order?this.orderby=t+" "+E[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){e.filter&&e.filter.length?this.where={[t]:e.filter[0]}:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,n,i,$){const I=r(l("uni-stat-breadcrumb"),S),E=_,L=x,M=c,V=r(l("uni-th"),u),q=r(l("uni-tr"),d),U=r(l("uni-td"),m),j=v,O=r(l("uni-tag"),k),A=r(l("uni-link"),w),F=r(l("uni-table"),g),P=r(l("uni-pagination"),D),R=r(l("unicloud-db"),z);return h(),s(M,{class:"fix-top-window"},{default:o((()=>[p(M,{class:"uni-header"},{default:o((()=>[p(I,{class:"uni-stat-breadcrumb-on-phone"}),p(M,{class:"uni-group"},{default:o((()=>[p(E,{class:"uni-search",type:"text",modelValue:i.query,"onUpdate:modelValue":t[0]||(t[0]=e=>i.query=e),onConfirm:$.search,placeholder:"搜索用户..."},null,8,["modelValue","onConfirm"]),p(L,{class:"uni-button",type:"primary",size:"mini",onClick:$.search},{default:o((()=>[f("搜索")])),_:1},8,["onClick"]),p(L,{class:"uni-button",type:"warn",size:"mini",disabled:!i.selectedIndexs.length,onClick:$.delTable},{default:o((()=>[f("批量删除")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1}),p(M,{class:"uni-container"},{default:o((()=>[p(R,{ref:"udb",collection:i.collection,where:i.where,"page-data":"replace",orderby:i.orderby,getcount:!0,"page-size":i.options.pageSize,"page-current":i.options.pageCurrent,options:i.options,loadtime:"manual",onLoad:$.onqueryload},{default:o((({data:e,pagination:a,loading:n,error:r})=>[p(F,{ref:"table",loading:n,emptyText:r.message||"暂无数据",border:"",stripe:"",type:"selection",onSelectionChange:$.selectionChange},{default:o((()=>[p(q,null,{default:o((()=>[p(V,{align:"center",sortable:"",onSortChange:t[1]||(t[1]=e=>$.sortChange(e,"userId"))},{default:o((()=>[f("用户ID")])),_:1}),p(V,{align:"center"},{default:o((()=>[f("头像")])),_:1}),p(V,{align:"center",sortable:"",onSortChange:t[2]||(t[2]=e=>$.sortChange(e,"nickname"))},{default:o((()=>[f("昵称")])),_:1}),p(V,{align:"center",sortable:"",onSortChange:t[3]||(t[3]=e=>$.sortChange(e,"phone"))},{default:o((()=>[f("手机号码")])),_:1}),p(V,{align:"center","filter-type":"select","filter-data":i.statusOptions,onFilterChange:t[4]||(t[4]=e=>$.filterChange(e,"status"))},{default:o((()=>[f("状态")])),_:1},8,["filter-data"]),p(V,{align:"center","filter-type":"select","filter-data":i.memberTypeOptions,onFilterChange:t[5]||(t[5]=e=>$.filterChange(e,"membertype"))},{default:o((()=>[f("会员类型")])),_:1},8,["filter-data"]),p(V,{align:"center","filter-type":"select","filter-data":i.memberStatusOptions,onFilterChange:t[6]||(t[6]=e=>$.filterChange(e,"memberStatus"))},{default:o((()=>[f("会员状态")])),_:1},8,["filter-data"]),p(V,{align:"center"},{default:o((()=>[f("剩余天数/次数")])),_:1}),p(V,{align:"center",sortable:"",onSortChange:t[7]||(t[7]=e=>$.sortChange(e,"memberExpireTime"))},{default:o((()=>[f("会员到期时间")])),_:1}),p(V,{align:"center",sortable:"",onSortChange:t[8]||(t[8]=e=>$.sortChange(e,"email"))},{default:o((()=>[f("邮箱")])),_:1}),p(V,{align:"center"},{default:o((()=>[f("简介")])),_:1}),p(V,{align:"center",sortable:"",onSortChange:t[9]||(t[9]=e=>$.sortChange(e,"registerTime"))},{default:o((()=>[f("注册时间")])),_:1}),p(V,{align:"center",sortable:"",onSortChange:t[10]||(t[10]=e=>$.sortChange(e,"lastLoginTime"))},{default:o((()=>[f("最后登录")])),_:1}),p(V,{align:"center"},{default:o((()=>[f("操作")])),_:1})])),_:1}),(h(!0),b(T,null,y(e,((e,t)=>(h(),s(q,{key:t},{default:o((()=>[p(U,{align:"center"},{default:o((()=>[f(C(e.userId),1)])),_:2},1024),p(U,{align:"center"},{default:o((()=>[p(j,{class:"user-avatar",src:e.avatarUrl||"/static/avatar.png",mode:"aspectFill",onError:t=>$.onAvatarError(e),onClick:t=>$.downloadAvatar(e.avatarUrl,e.nickname)},null,8,["src","onError","onClick"])])),_:2},1024),p(U,{align:"center"},{default:o((()=>[f(C(e.nickname),1)])),_:2},1024),p(U,{align:"center"},{default:o((()=>[f(C(e.phone),1)])),_:2},1024),p(U,{align:"center"},{default:o((()=>[p(O,{type:$.getStatusType(e.status),text:$.getStatusText(e.status)},null,8,["type","text"])])),_:2},1024),p(U,{align:"center"},{default:o((()=>[p(O,{type:$.getMemberTypeTag(e.membertype),text:$.getMemberTypeText(e.membertype)},null,8,["type","text"])])),_:2},1024),p(U,{align:"center"},{default:o((()=>[p(O,{type:$.getMemberStatusTag(e.memberStatus),text:$.getMemberStatusText(e.memberStatus)},null,8,["type","text"])])),_:2},1024),p(U,{align:"center"},{default:o((()=>["times"===e.membertype?(h(),b(T,{key:0},[f(C(e.remainingTimes||0)+"次 ",1)],64)):"daily"===e.membertype||"monthly"===e.membertype?(h(),b(T,{key:1},[f(C(e.remainingDays||0)+"天 ",1)],64)):(h(),b(T,{key:2},[f(" - ")],64))])),_:2},1024),p(U,{align:"center"},{default:o((()=>[f(C(e.memberExpireTime?$.formatDateTime(e.memberExpireTime):"-"),1)])),_:2},1024),p(U,{align:"center"},{default:o((()=>[p(A,{href:"mailto:"+e.email,text:e.email},null,8,["href","text"])])),_:2},1024),p(U,{align:"center"},{default:o((()=>[p(M,{class:"bio-cell",title:e.bio},{default:o((()=>[f(C(e.bio||"-"),1)])),_:2},1032,["title"])])),_:2},1024),p(U,{align:"center"},{default:o((()=>[f(C($.formatDateTime(e.registerTime)),1)])),_:2},1024),p(U,{align:"center"},{default:o((()=>[f(C($.formatDateTime(e.lastLoginTime)),1)])),_:2},1024),p(U,{align:"center"},{default:o((()=>[p(M,{class:"uni-group"},{default:o((()=>[p(L,{onClick:t=>$.navigateTo("./edit?id="+e.userId,!1),class:"uni-button",size:"mini",type:"primary"},{default:o((()=>[f("编辑")])),_:2},1032,["onClick"]),p(L,{onClick:t=>$.confirmDelete(e.userId),class:"uni-button",size:"mini",type:"warn"},{default:o((()=>[f("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),p(M,{class:"uni-pagination-box"},{default:o((()=>[p(P,{"show-icon":"","show-page-size":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:$.onPageChanged,onPageSizeChange:$.changeSize},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange","onPageSizeChange"])])),_:2},1024)])),_:1},8,["collection","where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}],["__scopeId","data-v-344e7e72"]]);export{L as default};
