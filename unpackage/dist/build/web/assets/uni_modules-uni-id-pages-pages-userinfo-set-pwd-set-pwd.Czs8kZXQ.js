import{_ as s,e as a,a1 as e,aa as o,q as t,s as r,a2 as n,r as i,a as l,c as d,w as u,i as c,o as p,h as m,k as f,j as w,u as h,v as g,p as P}from"./index-1tsbwzWw.js";import{_}from"./uni-match-media.BU10syLf.js";import{_ as y}from"./uni-easyinput.B-y-wvYA.js";import{_ as b}from"./uni-forms-item.C04_D_PQ.js";import{_ as k}from"./uni-id-pages-sms-form.pT1bQMAK.js";import{_ as D}from"./uni-forms.Cx-ojO0j.js";import{_ as I}from"./uni-popup-captcha.Dwaz3OKr.js";import{p as C}from"./password.BwaMQN3p.js";import"./uni-captcha.CeTk91ci.js";const U=a.importObject("uni-id-co",{customUI:!0});const V=s({name:"set-pwd.vue",data:()=>({uniIdRedirectUrl:"",loginType:"",logo:"/static/logo.png",focusNewPassword:!1,focusNewPassword2:!1,allowSkip:!1,formData:{code:"",captcha:"",newPassword:"",newPassword2:""},rules:C.getPwdRules("newPassword","newPassword2")}),computed:{userInfo:()=>e.userInfo},onReady(){this.$refs.form.setRules(this.rules)},onLoad(s){var a;this.uniIdRedirectUrl=s.uniIdRedirectUrl,this.loginType=s.loginType,o.setPasswordAfterLogin&&(null==(a=o.setPasswordAfterLogin)?void 0:a.allowSkip)&&(this.allowSkip=!0)},methods:{submit(){if(!/^\d{6}$/.test(this.formData.code))return this.$refs.smsCode.focusSmsCodeInput=!0,t({title:"验证码格式不正确",icon:"none"});this.$refs.form.validate().then((s=>{U.setPwd({password:this.formData.newPassword,code:this.formData.code,captcha:this.formData.captcha}).then((s=>{r({content:"密码设置成功",showCancel:!1,success:()=>{n.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl,loginType:this.loginType})}})})).catch((s=>{r({content:s.message,showCancel:!1})}))})).catch((s=>{"uni-id-captcha-required"==s.errCode?this.$refs.popup.open():console.log(s.errMsg)})).finally((s=>{this.formData.captcha=""}))},skip(){n.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl})}}},[["render",function(s,a,e,o,t,r){const n=h,C=c,U=g,V=i(l("uni-match-media"),_),j=i(l("uni-easyinput"),y),R=i(l("uni-forms-item"),b),v=i(l("uni-id-pages-sms-form"),k),B=P,x=i(l("uni-forms"),D),N=i(l("uni-popup-captcha"),I);return p(),d(C,{class:"uni-content"},{default:u((()=>[m(V,{"min-width":690},{default:u((()=>[m(C,{class:"login-logo"},{default:u((()=>[m(n,{src:t.logo},null,8,["src"])])),_:1}),m(U,{class:"title title-box"},{default:u((()=>[f("设置密码")])),_:1})])),_:1}),m(x,{class:"set-password-form",ref:"form",value:t.formData,"err-show-type":"toast"},{default:u((()=>[m(U,{class:"tip"},{default:u((()=>[f("输入密码")])),_:1}),m(R,{name:"newPassword"},{default:u((()=>[m(j,{focus:t.focusNewPassword,onBlur:a[0]||(a[0]=s=>t.focusNewPassword=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:t.formData.newPassword,"onUpdate:modelValue":a[1]||(a[1]=s=>t.formData.newPassword=s),placeholder:"请输入密码"},null,8,["focus","modelValue"])])),_:1}),m(U,{class:"tip"},{default:u((()=>[f("再次输入密码")])),_:1}),m(R,{name:"newPassword2"},{default:u((()=>[m(j,{focus:t.focusNewPassword2,onBlur:a[2]||(a[2]=s=>t.focusNewPassword2=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:t.formData.newPassword2,"onUpdate:modelValue":a[3]||(a[3]=s=>t.formData.newPassword2=s),placeholder:"请再次输入新密码"},null,8,["focus","modelValue"])])),_:1}),m(v,{modelValue:t.formData.code,"onUpdate:modelValue":a[4]||(a[4]=s=>t.formData.code=s),type:"set-pwd-by-sms",ref:"smsCode",phone:r.userInfo.mobile},null,8,["modelValue","phone"]),m(C,{class:"link-box"},{default:u((()=>[m(B,{class:"uni-btn send-btn",type:"primary",onClick:r.submit},{default:u((()=>[f("确认")])),_:1},8,["onClick"]),t.allowSkip?(p(),d(B,{key:0,class:"uni-btn send-btn",type:"default",onClick:r.skip},{default:u((()=>[f("跳过")])),_:1},8,["onClick"])):w("",!0)])),_:1})])),_:1},8,["value"]),m(N,{onConfirm:r.submit,modelValue:t.formData.captcha,"onUpdate:modelValue":a[5]||(a[5]=s=>t.formData.captcha=s),scene:"set-pwd-by-sms",ref:"popup"},null,8,["onConfirm","modelValue"])])),_:1})}],["__scopeId","data-v-f34b7681"]]);export{V as default};
